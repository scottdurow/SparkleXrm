// Client.js
(function($){
window.dev1_session_StatusCode=function(){};dev1_session_StatusCode.prototype = {draft:1}
dev1_session_StatusCode.registerEnum('dev1_session_StatusCode',false);window.ActivityPointer=function(){ActivityPointer.initializeBase(this,['activitypointer']);}
ActivityPointer.prototype={activityid:null,subject:null,activitytypecode:null,regardingobjectid:null,displaySubject:null,$1_0:function(){this.logicalName=this.activitytypecode;}}
window.dev1_session=function(){dev1_session.initializeBase(this,['dev1_session']);this._metaData['dev1_duration']=Xrm.Sdk.AttributeTypes.int_;}
dev1_session.prototype={createdon:null,dev1_description:null,dev1_duration:null,dev1_activityid:null,dev1_activitytypename:null,dev1_emailid:null,dev1_phonecallid:null,dev1_letterid:null,dev1_taskid:null,dev1_endtime:null,dev1_row:null,statuscode:null,dev1_sessionid:null,dev1_starttime:null,contract_customerid:null,incident_customerid:null,opportunity_customerid:null,activitypointer_regardingobjectid:null,activitypointer_subject:null,account:null}
Type.registerNamespace('AddressSearch');AddressSearch.App=function(){}
Type.registerNamespace('Client.ContactEditor.ViewModels');Client.ContactEditor.ViewModels.AssignRequest=function(){}
Client.ContactEditor.ViewModels.AssignRequest.prototype={target:null,assignee:null,serialise:function(){return '<request i:type="c:AssignRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:c="http://schemas.microsoft.com/crm/2011/Contracts">'+'        <a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">'+'          <a:KeyValuePairOfstringanyType>'+'            <b:key>Target</b:key>'+Xrm.Sdk.Attribute.serialiseValue(this.target,null)+'          </a:KeyValuePairOfstringanyType>'+'          <a:KeyValuePairOfstringanyType>'+'            <b:key>Assignee</b:key>'+Xrm.Sdk.Attribute.serialiseValue(this.assignee,null)+'          </a:KeyValuePairOfstringanyType>'+'        </a:Parameters>'+'        <a:RequestId i:nil="true" />'+'        <a:RequestName>Assign</a:RequestName>'+'      </request>';}}
Client.ContactEditor.ViewModels.AssignResponse=function(response){}
Client.ContactEditor.ViewModels.ContactValidation=function(){}
Client.ContactEditor.ViewModels.ContactValidation.firstName=function(rules,viewModel,dataContext){var $0=ko.utils.unwrapObservable(viewModel);return rules.addRequiredMsg('Enter a first name').addRule('Must be less than 200 chars',function($p1_0){
var $1_0=$p1_0;return ($1_0.length<200);}).addRule("Firstname can't be the same as the lastname",function($p1_0){
var $1_0=true;var $1_1=ko.utils.unwrapObservable($0.lastname);if($1_1!=null&&$p1_0===$1_1){$1_0=false;}return $1_0;});}
Client.ContactEditor.ViewModels.ContactValidation.birthDate=function(rules,viewModel,dataContext){var $0=viewModel;return rules.addRule("Birthdate can't be in the future",function($p1_0){
var $1_0=$p1_0;return ($1_0<Date.get_today());});}
Client.ContactEditor.ViewModels.ContactValidation.accountRoleCode=function(rules,viewModel,dataContext){return rules.addRule('Account Role is required.',function($p1_0){
return ($p1_0!=null)&&($p1_0).value!=null;});}
Client.ContactEditor.ViewModels.ContactValidation.register=function(binder){binder.register('firstname',Client.ContactEditor.ViewModels.ContactValidation.firstName);binder.register('accountrolecode',Client.ContactEditor.ViewModels.ContactValidation.accountRoleCode);binder.register('birthdate',Client.ContactEditor.ViewModels.ContactValidation.birthDate);}
Client.ContactEditor.ViewModels.ObservableContact=function(){this.entityState=ko.observable();this.fullname=ko.observable();this.firstname=ko.observable();this.lastname=ko.observable();this.birthdate=ko.observable();this.accountrolecode=ko.observable();this.numberofchildren=ko.observable();this.transactioncurrencyid=ko.observable();this.parentcustomerid=ko.observable();this.creditlimit=ko.observable();}
Client.ContactEditor.ViewModels.ObservableContact.prototype={$0:null,setValue:function(value){this.$0=value;if(value==null){this.$0=new Client.ContactEditor.Model.Contact();}this.entityState(this.$0.entityState);this.fullname(this.$0.fullname);this.firstname(this.$0.firstname);this.lastname(this.$0.lastname);this.birthdate(this.$0.birthdate);this.accountrolecode(this.$0.accountrolecode);this.numberofchildren(this.$0.numberofchildren);this.transactioncurrencyid(this.$0.transactioncurrencyid);this.parentcustomerid(this.$0.parentcustomerid);this.creditlimit(this.$0.creditlimit);},commit:function(){this.$0.fullname=this.fullname();this.$0.firstname=this.firstname();this.$0.lastname=this.lastname();this.$0.birthdate=this.birthdate();this.$0.accountrolecode=this.accountrolecode();this.$0.numberofchildren=this.numberofchildren();this.$0.transactioncurrencyid=this.transactioncurrencyid();this.$0.creditlimit=this.creditlimit();this.$0.entityState=Xrm.Sdk.EntityStates.changed;this.$0.parentcustomerid=this.parentcustomerid();return this.$0;}}
Client.ContactEditor.ViewModels.ContactsEditorViewModel=function(){Client.ContactEditor.ViewModels.ContactsEditorViewModel.initializeBase(this);this.selectedContact=ko.validatedObservable(new Client.ContactEditor.ViewModels.ObservableContact());this.contacts=new SparkleXrm.GridEditor.EntityDataViewModel(10,Client.ContactEditor.Model.Contact,true);this.contacts.add_onSelectedRowsChanged(ss.Delegate.create(this,this.onSelectedRowsChanged));this.contacts.set_fetchXml("<fetch version='1.0' output-format='xml-platform' mapping='logical' returntotalrecordcount='true' no-lock='true' distinct='false' count='{0}' paging-cookie='{1}' page='{2}'>\r\n                <entity name='contact'>\r\n                    <attribute name='firstname' />\r\n                    <attribute name='lastname' />\r\n                    <attribute name='telephone1' />\r\n                    <attribute name='birthdate' />\r\n                    <attribute name='accountrolecode' />\r\n                    <attribute name='parentcustomerid'/>\r\n                    <attribute name='transactioncurrencyid'/>\r\n                    <attribute name='creditlimit'/>\r\n                    <attribute name='numberofchildren'/>\r\n                    <attribute name='contactid' />\r\n                    <attribute name='ownerid'/>{3}\r\n                  </entity>\r\n                </fetch>");Client.ContactEditor.ViewModels.ContactValidation.register(this.contacts.validationBinder);Client.ContactEditor.ViewModels.ContactValidation.register(new SparkleXrm.ObservableValidationBinder(this.selectedContact));}
Client.ContactEditor.ViewModels.ContactsEditorViewModel.prototype={contacts:null,selectedContact:null,onSelectedRowsChanged:function(){var $0=this.contacts.getSelectedRows();if($0.length>0){this.selectedContact().setValue(this.contacts.getItem($0[0].fromRow));}else{this.selectedContact().setValue(null);}},$1_0:null,canAddNew:function(){if(this.$1_0==null){var $0={};$0.owner=this;$0.read=ss.Delegate.create(this,function(){
var $1_0=this.selectedContact().entityState();if($1_0!=null){return $1_0!==Xrm.Sdk.EntityStates.created;}else{return true;}});this.$1_0=ko.dependentObservable($0);}return this.$1_0;},$1_1:null,saveSelectedContact:function(){if(this.$1_1==null){this.$1_1=ss.Delegate.create(this,function(){
if((this.selectedContact).isValid()){var $1_0=this.selectedContact().commit();var $1_1=this.selectedContact();if($1_1.entityState()===Xrm.Sdk.EntityStates.created){this.contacts.addItem($1_0);var $1_2=this.contacts.getPagingInfo();var $1_3=new Array(1);$1_3[0]={};$1_3[0].fromRow=$1_2.totalRows-(($1_2.totalPages-1)*$1_2.pageSize)-1;this.contacts.raiseOnSelectedRowsChanged($1_3);$1_1.entityState(Xrm.Sdk.EntityStates.changed);}else{this.contacts.refresh();}}else{this.selectedContact.errors.showAllMessages();}});}return this.$1_1;},$1_2:null,addNewContact:function(){if(this.$1_2==null){this.$1_2=ss.Delegate.create(this,function(){
var $1_0=new Client.ContactEditor.Model.Contact();$1_0.entityState=Xrm.Sdk.EntityStates.created;this.selectedContact().setValue($1_0);this.selectedContact.errors.showAllMessages(false);});}return this.$1_2;},$1_3:null,resetCommand:function(){if(this.$1_3==null){this.$1_3=ss.Delegate.create(this,function(){
var $1_0=confirm(String.format('Are you sure you want to reset the grid? This will loose any values you have edited.'));if(!$1_0){return;}this.contacts.reset();this.contacts.refresh();});}return this.$1_3;},$1_4:null,saveCommand:function(){if(this.$1_4==null){this.$1_4=ss.Delegate.create(this,function(){
var $1_0=[];var $enum1=ss.IEnumerator.getEnumerator(this.contacts.get_data());while($enum1.moveNext()){var $1_4=$enum1.current;if($1_4!=null&&$1_4.entityState!==Xrm.Sdk.EntityStates.unchanged){$1_0.add($1_4);}}var $1_1=$1_0.length;if(!$1_1){return;}var $1_2=confirm(String.format('Are you sure that you want to save the {0} records edited in the Grid?',$1_1));if(!$1_2){return;}this.isBusy(true);var $1_3='';this.$1_6($1_0,$1_3,ss.Delegate.create(this,function(){
if($1_3.length>0){alert('One or more records failed to save.\nPlease contact your System Administrator.\n\n'+$1_3);}else{alert('Save Complete!');}this.contacts.refresh();this.isBusy(false);}));});}return this.$1_4;},transactionCurrencySearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='transactioncurrency'>\r\n                                <attribute name='transactioncurrencyid' />\r\n                                <attribute name='currencyname' />\r\n                                <attribute name='isocurrencycode' />\r\n                                <attribute name='currencysymbol' />\r\n                                <attribute name='exchangerate' />\r\n                                <attribute name='currencyprecision' />\r\n                                <order attribute='currencyname' descending='false' />\r\n                                <filter type='and'>\r\n                                  <condition attribute='currencyname' operator='like' value='%{0}%' />\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},AddNewAccountInLine:function(item){var $0={};$0.openInNewWindow=true;Xrm.Utility.openEntityForm('account',null,null,$0);},ownerSearchCommand:function(term,callback){var $0={};$0['systemuser']='fullname';$0['team']='name';var $1=0;var $2=[];var $3=function($p1_0){
$1++;$2.addRange($p1_0.get_entities().items());$2.sort(function($p2_0,$p2_1){
return String.compare($p2_0.getAttributeValueString('name'),$p2_1.getAttributeValueString('name'));});if($1===Object.getKeyCount($0)){var $1_0=new Xrm.Sdk.EntityCollection($2);callback($1_0);}};var $enum1=ss.IEnumerator.getEnumerator(Object.keys($0));while($enum1.moveNext()){var $4=$enum1.current;this.$1_5(term,$3,$4,$0[$4]);}},AccountSearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='account'>\r\n                                <attribute name='accountid' />\r\n                                <attribute name='name' />\r\n                                <attribute name='address1_city' />\r\n                                <order attribute='name' descending='false' />\r\n                                <filter type='and'>\r\n                                  <condition attribute='name' operator='like' value='%{0}%' />\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},$1_5:function($p0,$p1,$p2,$p3){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false' no-lock='true' count='25'>\r\n                              <entity name='{1}'>\r\n                                <attribute name='{2}' alias='name' />\r\n                                <order attribute='{2}' descending='false' />\r\n                                <filter type='and'>\r\n                                  <condition attribute='{2}' operator='like' value='%{0}%' />\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode($p0),$p2,$p3);Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);$p1($1_0);});},reportError:function(ex){},$1_6:function($p0,$p1,$p2){var $0=$p0[0];if($0.contactid==null){Xrm.Sdk.OrganizationServiceProxy.beginCreate($0,ss.Delegate.create(this,function($p1_0){
try{var $1_0=Xrm.Sdk.OrganizationServiceProxy.endCreate($p1_0);$0.contactid=$1_0;$0.entityState=Xrm.Sdk.EntityStates.unchanged;}catch($1_1){$p1=$p1+$1_1.message+'\n';}$p0.remove($0);if(!$p0.length){$p2();}else{this.$1_6($p0,$p1,$p2);}}));}else{Xrm.Sdk.OrganizationServiceProxy.beginUpdate($0,ss.Delegate.create(this,function($p1_0){
try{Xrm.Sdk.OrganizationServiceProxy.endUpdate($p1_0);$0.entityState=Xrm.Sdk.EntityStates.unchanged;if($0.ownerid!=null){Xrm.Sdk.OrganizationServiceProxy.registerExecuteMessageResponseType('Assign',Client.ContactEditor.ViewModels.AssignResponse);var $1_0=new Client.ContactEditor.ViewModels.AssignRequest();$1_0.target=$0.toEntityReference();$1_0.assignee=$0.ownerid;Xrm.Sdk.OrganizationServiceProxy.execute($1_0);}}catch($1_1){$p1=$p1+$1_1.message+'\n';}$p0.remove($0);if(!$p0.length){$p2();}else{this.$1_6($p0,$p1,$p2);}}));}},init:function(){this.contacts.refresh();}}
Type.registerNamespace('Client.DataGrouping.ViewModels');Client.DataGrouping.ViewModels.DataGroupingViewModel=function(){Client.DataGrouping.ViewModels.DataGroupingViewModel.initializeBase(this);var $0={};$0.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider();$0.inlineFilters=true;this.projects=new Slick.Data.DataView($0);this.projects.beginUpdate();this.projects.setFilter(Client.DataGrouping.ViewModels.DataGroupingViewModel.myFilter);var $1={percentComplete:0};this.projects.setFilterArgs($1);this.loadData();this.setGrouping();this.projects.endUpdate();}
Client.DataGrouping.ViewModels.DataGroupingViewModel.myFilter=function(item,args){return true;}
Client.DataGrouping.ViewModels.DataGroupingViewModel.prototype={projects:null,sortCol:null,sortDir:0,setGrouping:function(){var $0={};$0.getter='duration';$0.aggregators=[new Slick.Data.Aggregators.Sum('duration'),new Slick.Data.Aggregators.Sum('cost')];$0.aggregateCollapsed=false;var $1={};$1.getter='effortDriven';$1.aggregators=[new Slick.Data.Aggregators.Sum('duration'),new Slick.Data.Aggregators.Sum('cost')];$1.collapsed=false;var $2={};$2.getter='effortDriven';$2.aggregators=[new Slick.Data.Aggregators.Avg('percentComplete')];$2.collapsed=false;this.projects.setGrouping([$0,$1,$2]);},loadData:function(){var $0=['01/01/2009','02/02/2009','03/03/2009'];var $1=[];for(var $2=0;$2<100;$2++){var $3=new Client.DataGrouping.ViewModels.Project();Xrm.ArrayEx.add($1,$3);$3.id='id_'+$2;$3.num=$2;$3.title='Task '+$2;$3.duration=Math.round(Math.random()*14);$3.percentComplete=Math.round(Math.random()*100);$3.start=$0[Math.floor((Math.random()*2))];$3.finish=$0[Math.floor((Math.random()*2))];$3.cost=Math.round(Math.random()*10000)/100;$3.effortDriven=(!($2%5));}this.projects.setItems($1);}}
Client.DataGrouping.ViewModels.Project=function(){}
Client.DataGrouping.ViewModels.Project.prototype={id:null,num:null,title:null,duration:null,percentComplete:null,start:null,finish:null,cost:null,effortDriven:null}
Client.DataGrouping.ViewModels.TreeDataView=function(){this.$1_2={};this.$1_3={};this._items=[];this._rows=[];Client.DataGrouping.ViewModels.TreeDataView.initializeBase(this);}
Client.DataGrouping.ViewModels.TreeDataView.prototype={$1_0:false,$1_1:null,$1_4:null,beginUpdate:function(){this.$1_0=true;},endUpdate:function(){this.$1_0=false;this.refresh();},sort:function(sorting){this.$1_4=new SparkleXrm.GridEditor.SortCol(sorting.sortCol.field,sorting.sortAsc);this.refresh();},addItem:function(item){this._items.add(item);this.refresh();},insertItem:function(insertBefore,item){this._items.insert(insertBefore,item);this.refresh();},removeItem:function(id){this._items.remove(id);this.refresh();},getItem:function(index){return this._rows[index];},getLength:function(){return this._rows.length;},getItemMetadata:function(i){return Client.DataGrouping.ViewModels.TreeDataView.callBaseMethod(this, 'getItemMetadata',[i]);},expandGroup:function(groupingKey){if(Object.keyExists(this.$1_2,groupingKey)){this.$1_2[groupingKey]=!this.$1_2[groupingKey];}this.$1_1=this.$1_3[groupingKey].count-1;this.refresh();},collapseGroup:function(groupingKey){if(Object.keyExists(this.$1_2,groupingKey)){this.$1_2[groupingKey]=!this.$1_2[groupingKey];}this.$1_1=this.$1_3[groupingKey].count-1;this.refresh();},refresh:function(){if(this.$1_0){return;}var $0=[];this.$1_5($0,null,null,0);this._rows=$0;var $1={};$1.rows=[];var $2=(this.$1_1!=null)?this.$1_1:0;for(var $3=$2;$3<$0.length;$3++){$1.rows.add($3);}this.onRowsChanged.notify($1,null,null);},$1_5:function($p0,$p1,$p2,$p3){var $0;var $1=($p3==null)?0:$p3+1;if($p1!=null){$0=$p1.childItems;}else{$0=this._items;}var $2=[];var $3=[$0];for(var $4=0;$4<$0.length;$4++){$3[$4]=$0[$4];}if(this.$1_4!=null){this.$1_6(this.$1_4,$3);}var $enum1=ss.IEnumerator.getEnumerator($3);while($enum1.moveNext()){var $5=$enum1.current;var $6=$5;if(typeof($6.childItems)!=='undefined'){var $7=(($p1!=null)?$p1.id:'')+'|'+$6.id;var $8;if(Object.keyExists(this.$1_3,$7)){$8=this.$1_3[$7];}else{$8={};this.$1_3[$7]=$8;}$8.title=$6.title.toString();$8.rows=[];$8.groupingKey=$7;var $9=false;if(Object.keyExists(this.$1_2,$7)){$9=this.$1_2[$7];}else{this.$1_2[$7]=$9;}$8.level=$1;$2.add($8);$8.count=$p0.length+$2.length;$8.collapsed=$9;if(!$9){this.$1_5($2,$6,$8,$1);}}else{$2.add($5);}}$p0.addRange($2);},$1_6:function($p0,$p1){if(!$p0.ascending){$p1.reverse();}$p1.sort(function($p1_0,$p1_1){
var $1_0=($p1_0)[$p0.attributeName];var $1_1=($p1_1)[$p0.attributeName];var $1_2=0;var $1_3='';if($1_0!=null){$1_3=Type.getInstanceType($1_0).get_name();}else if($1_1!=null){$1_3=Type.getInstanceType($1_1).get_name();}if($1_0!==$1_1){switch($1_3.toLowerCase()){case 'string':$1_0=($1_0!=null)?($1_0).toLowerCase():null;$1_1=($1_1!=null)?($1_1).toLowerCase():null;if($1_0<$1_1){$1_2=-1;}else{$1_2=1;}break;case 'date':if($1_0<$1_1){$1_2=-1;}else{$1_2=1;}break;case 'number':var $1_4=($1_0!=null)?($1_0):0;var $1_5=($1_1!=null)?($1_1):0;$1_2=($1_4-$1_5);break;case 'money':var $1_6=($1_0!=null)?($1_0).value:0;var $1_7=($1_1!=null)?($1_1).value:0;$1_2=($1_6-$1_7);break;case 'optionsetvalue':var $1_8=($1_0!=null)?($1_0).value:0;$1_8=($1_8!=null)?$1_8:0;var $1_9=($1_1!=null)?($1_1).value:0;$1_9=($1_9!=null)?$1_9:0;$1_2=($1_8-$1_9);break;case 'entityreference':var $1_A=(($1_0!=null)&&(($1_0).name!=null))?($1_0).name:'';var $1_B=($1_1!=null&&(($1_1).name!=null))?($1_1).name:'';if($1_A<$1_B){$1_2=-1;}else{$1_2=1;}break;}}return $1_2;});if(!$p0.ascending){$p1.reverse();}}}
Client.DataGrouping.ViewModels.TreeDataViewModel=function(){Client.DataGrouping.ViewModels.TreeDataViewModel.initializeBase(this);this.items=new Client.DataGrouping.ViewModels.TreeDataView();this.items.beginUpdate();var $0=1;var $1=Client.DataGrouping.ViewModels.TreeDataViewModel.$1_0('Project 1',$0.toString());$1.childItems=[];for(var $2=2;$2<100;$2++){$0++;var $3=new Client.DataGrouping.ViewModels.GroupedItems();$3.title='Project '+$0.toString();$3.id=new Xrm.Sdk.Guid($0.toString());$3.childItems=[];for(var $4=0;$4<25;$4++){$0++;Client.DataGrouping.ViewModels.TreeDataViewModel.$1_1($3,'Item '+$0.toString());}$1.childItems.add($3);}this.items.addItem($1);this.items.endUpdate();}
Client.DataGrouping.ViewModels.TreeDataViewModel.$1_0=function($p0,$p1){var $0=new Client.DataGrouping.ViewModels.GroupedItems();$0.title=$p0;$0.childItems=[];$0.id=new Xrm.Sdk.Guid($p1);return $0;}
Client.DataGrouping.ViewModels.TreeDataViewModel.$1_1=function($p0,$p1){var $0=new Client.DataGrouping.ViewModels.TreeItem();$0.id=new Xrm.Sdk.Guid('3');$0.status='1';$0.project=$p1;$p0.childItems.add($0);}
Client.DataGrouping.ViewModels.TreeDataViewModel.prototype={items:null}
Client.DataGrouping.ViewModels.TreeItem=function(){}
Client.DataGrouping.ViewModels.TreeItem.prototype={id:null,status:null,project:null,date:null,employee:null,duration:null,items:null}
Client.DataGrouping.ViewModels.GroupedItems=function(){}
Client.DataGrouping.ViewModels.GroupedItems.prototype={id:null,title:null,childItems:null}
Type.registerNamespace('Client.DataGrouping.Views');Client.DataGrouping.Views.DataGroupingView=function(){}
Client.DataGrouping.Views.DataGroupingView.init=function(){var $0=new Client.DataGrouping.ViewModels.DataGroupingViewModel();var $1=Xrm.NumberEx.getNumberFormatInfo();$1.minValue=0;$1.maxValue=1000;$1.precision=2;var $2={};$2.falseOptionDisplayName='No';$2.trueOptionDisplayName='Yes';var $3=Client.DataGrouping.Views.DataGroupingView.sumTotalsFormatter;var $4=Client.DataGrouping.Views.DataGroupingView.avgTotalsFormatter;var $5=SparkleXrm.GridEditor.XrmNumberEditor.formatter;var $6=SparkleXrm.GridEditor.XrmBooleanEditor.formatter;var $7=[{id:'sel',name:'#',field:'num',cssClass:'cell-selection',width:40,resizable:false,selectable:false,focusable:false},{id:'title',name:'Title',field:'title',width:70,minWidth:50,cssClass:'cell-title',sortable:true,editor:SparkleXrm.GridEditor.XrmTextEditor.textEditor},{id:'duration',name:'Duration',field:'duration',width:70,sortable:true,groupTotalsFormatter:$3},{id:'%',name:'% Complete',field:'percentComplete',width:80,formatter:$5,options:$1,sortable:true,groupTotalsFormatter:$4},{id:'start',name:'Start',field:'start',minWidth:60,sortable:true},{id:'finish',name:'Finish',field:'finish',minWidth:60,sortable:true},{id:'cost',name:'Cost',field:'cost',width:90,sortable:true,groupTotalsFormatter:$3},{id:'effort-driven',name:'Effort Driven',width:80,minWidth:20,cssClass:'cell-effort-driven',field:'effortDriven',formatter:$6,options:$2,sortable:true}];var $8={};$8.enableCellNavigation=true;$8.editable=true;var $9=$0.projects;var $A=new SparkleXrm.GridEditor.GridDataViewBinder();var $B=$A.dataBindDataViewGrid($0.projects,$7,'myGrid',null,true,false);$B.registerPlugin(new Slick.Data.GroupItemMetadataProvider());SparkleXrm.ViewBase.registerViewModel($0);}
Client.DataGrouping.Views.DataGroupingView.sumTotalsFormatter=function(totals,columnDef){var $0=totals['sum'];var $1=($0!=null)?$0[columnDef.field]:null;if($1!=null){return 'avg: '+Math.round($1).toString()+' %';}return '';}
Client.DataGrouping.Views.DataGroupingView.avgTotalsFormatter=function(totals,columnDef){var $0=totals['avg'];var $1=($0!=null)?$0[columnDef.field]:null;if($1!=null){return 'total: '+(Math.round($1*100)/100);}return '';}
Client.DataGrouping.Views.GroupGridRowPlugin=function(){}
Client.DataGrouping.Views.GroupGridRowPlugin.prototype={$0:null,init:function(grid){this.$0=grid;this.$0.onClick.subscribe(ss.Delegate.create(this,this.handleGridClick));},destroy:function(){if(this.$0!=null){this.$0.onClick.unsubscribe(ss.Delegate.create(this,this.handleGridClick));}},handleGridClick:function(e,a){var $0=a;var $1=this.$0.getDataItem($0.row);if(Type.getInstanceType($1)===Object){var $2=this.$0.getData();var $3=$1;if($3.collapsed){$2.expandGroup($3.groupingKey);}else{$2.collapseGroup($3.groupingKey);}e.stopImmediatePropagation();e.preventDefault();}}}
Client.DataGrouping.Views.TreeView=function(){}
Client.DataGrouping.Views.TreeView.init=function(){var $0=new Client.DataGrouping.ViewModels.TreeDataViewModel();var $1=new SparkleXrm.GridEditor.GridDataViewBinder();var $2=[{id:'status',name:'Status',field:'status',width:70,minWidth:50,cssClass:'cell-title',sortable:true},{id:'project',name:'Project',field:'project',width:70,minWidth:50,cssClass:'cell-title',sortable:true,editor:SparkleXrm.GridEditor.XrmTextEditor.textEditor},{id:'date',name:'Date',field:'date',width:70,sortable:true},{id:'employee',name:'Employee',field:'employee',width:80,sortable:true},{id:'duration',name:'Duration',field:'duration',minWidth:60,sortable:true}];$0.items.add_onGetItemMetaData(Client.DataGrouping.Views.TreeView.$0);var $3=$1.dataBindXrmGrid($0.items,$2,'projectsGrid',null,true,false);$3.registerPlugin(new Client.DataGrouping.Views.GroupGridRowPlugin());SparkleXrm.ViewBase.registerViewModel($0);}
Client.DataGrouping.Views.TreeView.$0=function($p0){var $0=$p0;if($0.level!=null){return Client.DataGrouping.Views.TreeView.getGroupRowMetadata($p0);}else{return null;}}
Client.DataGrouping.Views.TreeView.getGroupRowMetadata=function(item){var $0={};$0.selectable=false;$0.focusable=true;$0.cssClasses='slick-group';$0.columns={};var $1={};$0.columns[0]=$1;$1.colspan='*';$1.formatter=Client.DataGrouping.Views.TreeView.groupCellFormatter;$1.editor=null;return $0;}
Client.DataGrouping.Views.TreeView.groupCellFormatter=function(row,cell,value,columnDef,dataContext){var $0=dataContext;var $1=($0.level*15).toString()+'px';return "<span class='slick-group-toggle "+(($0.collapsed)?'collapsed':'expanded')+"' style='margin-left:"+$1+"'>"+'</span>'+"<span class='slick-group-title' level='"+$0.level+"'>"+$0.title+'</span>';}
Type.registerNamespace('Client.InlineSubGrids.ViewModels');Client.InlineSubGrids.ViewModels.ActivitySubGridViewModel=function(){Client.InlineSubGrids.ViewModels.ActivitySubGridViewModel.initializeBase(this);var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='savedquery'>\r\n                                <attribute name='name' />\r\n                                <attribute name='fetchxml' />\r\n                                <attribute name='layoutxml' />\r\n                                <attribute name='returnedtypecode' />\r\n                                <filter type='and'>\r\n                                <filter type='or'>";$0+="<condition attribute='returnedtypecode' operator='eq' value='"+'4200'+"'/>";$0+="\r\n                                    </filter>\r\n                                 <condition attribute='isquickfindquery' operator='eq' value='1'/>\r\n                                    <condition attribute='isdefault' operator='eq' value='1'/>\r\n                                </filter>\r\n                               \r\n                              </entity>\r\n                            </fetch>";var $1=Xrm.Sdk.OrganizationServiceProxy.retrieveMultiple($0);this.$1_0=new Client.MultiEntitySearch.ViewModels.QueryParser();var $2=$1.get_entities().get_item(0);var $3=$2.getAttributeValueString('fetchxml');var $4=$2.getAttributeValueString('layoutxml');this.viewConfig=this.$1_0.parse($3,$4);this.viewConfig.dataView=new SparkleXrm.GridEditor.EntityDataViewModel(10,Xrm.Sdk.Entity,true);this.$1_0.queryDisplayNames();}
Client.InlineSubGrids.ViewModels.ActivitySubGridViewModel.prototype={viewConfig:null,$1_0:null,init:function(){this.viewConfig.dataView.set_fetchXml(this.$1_0.getFetchXmlForQuery(this.viewConfig,'%'+''+'%'));this.viewConfig.dataView.reset();this.viewConfig.dataView.resetPaging();this.viewConfig.dataView.refresh();}}
Client.InlineSubGrids.ViewModels.BooksCollection=function(){this.$1_2=[];Client.InlineSubGrids.ViewModels.BooksCollection.initializeBase(this);}
Client.InlineSubGrids.ViewModels.BooksCollection.prototype={$1_0:false,$1_1:false,suspend:function(){this.$1_0=true;this.$1_1=false;},unsuspend:function(){this.$1_0=false;if(this.$1_1){this.refresh();}this.$1_1=false;},addItem:function(item){Xrm.ArrayEx.add(this.$1_2,item);this.refresh();},getItem:function(index){return this.$1_2[index];},getLength:function(){return this.$1_2.length;},refresh:function(){if(this.$1_0){this.$1_1=true;return;}var $0={};$0.rows=[];for(var $1=0;$1<this.$1_2.length;$1++){$0.rows.add($1);}this.onDataLoaded.notify(null,null,this);this.onRowsChanged.notify($0,null,this);},getPagingInfo:function(){return null;},sort:function(sorting){if(!sorting.sortAsc){this.$1_2.reverse();}this.$1_2.sort(function($p1_0,$p1_1){
return Xrm.Sdk.Entity.sortDelegate(sorting.sortCol.field,$p1_0,$p1_1);});if(!sorting.sortAsc){this.$1_2.reverse();}},removeItem:function(id){this.$1_2.remove(id);this.refresh();},clear:function(){this.$1_2.clear();this.refresh();},reset:function(){this.raiseOnSelectedRowsChanged(null);},getEnumerator:function(){return this.$1_2.getEnumerator();}}
Client.InlineSubGrids.ViewModels.BookValidation=function(){}
Client.InlineSubGrids.ViewModels.BookValidation.publishDate=function(rules,viewModel,dataContext){var $0=viewModel;return rules.addRule("Publish date can't be more than 1 year in the future",function($p1_0){
var $1_0=$p1_0;return ($1_0<Xrm.Sdk.DateTimeEx.dateAdd('days',365,Date.get_today()));});}
Client.InlineSubGrids.ViewModels.BookValidation.register=function(binder){binder.register('publishdate',Client.InlineSubGrids.ViewModels.BookValidation.publishDate);}
Client.InlineSubGrids.ViewModels.ContactCardViewModel=function(){Client.InlineSubGrids.ViewModels.ContactCardViewModel.initializeBase(this);var $0="<fetch version='1.0' output-format='xml-platform' \r\n                                mapping='logical' distinct='false'>\r\n                              <entity name='contact'>\r\n                               <attribute name='fullname' />\r\n                                <attribute name='telephone1' />\r\n                                <attribute name='emailaddress1' />\r\n                                <attribute name='contactid' />\r\n                                <attribute name='jobtitle' />\r\n                                <attribute name='parentcustomerid' />\r\n                                <attribute name='address1_city' />\r\n                                <attribute name='entityimage_url' />\r\n                                <order attribute='fullname' descending='false' />\r\n                              </entity>\r\n                            </fetch>";var $1=Xrm.Sdk.OrganizationServiceProxy.retrieveMultiple($0);this.contacts=$1.get_entities().items();}
Client.InlineSubGrids.ViewModels.ContactCardViewModel.prototype={contacts:null,getImageUrl:function(contact){if(contact.entityimage_url!=null){return Xrm.Page.context.getClientUrl()+contact.entityimage_url;}else{return '../images/EmptyContactImage.png';}}}
Client.InlineSubGrids.ViewModels.Book=function(){Client.InlineSubGrids.ViewModels.Book.initializeBase(this,['book']);}
Client.InlineSubGrids.ViewModels.Book.prototype={title:null,author:null,publishdate:null,format:null,price:null,numberofcopies:0,outofprint:false,language:null,audiolength:0,starttime:null}
Client.InlineSubGrids.ViewModels.SimpleEditableGridViewModel=function(){this.Books=new Client.InlineSubGrids.ViewModels.BooksCollection();Client.InlineSubGrids.ViewModels.SimpleEditableGridViewModel.initializeBase(this);Client.InlineSubGrids.ViewModels.BookValidation.register(this.Books.validationBinder);}
Client.InlineSubGrids.ViewModels.SimpleEditableGridViewModel.prototype={$1_0:null,loadBooks:function(){this.Books.suspend();var $0=Math.random()*10;var $1=Math.random()*10;for(var $2=$0;$2<($1+$0);$2++){var $3=new Client.InlineSubGrids.ViewModels.Book();$3.title='The Lord of the Rings '+$2.toLocaleString();$3.author='J. R. R. Tolkien';$3.publishdate=new Date(1954,7,29);$3.format=new Xrm.Sdk.OptionSetValue(1);$3.format.name='Paper Back';$3.price=new Xrm.Sdk.Money(12.99);this.Books.addItem($3);var $4=new Client.InlineSubGrids.ViewModels.Book();$4.title='The Hobbit '+$2.toLocaleString();$4.author='J. R. R. Tolkien';$4.publishdate=new Date(1932,9,21);$4.format=new Xrm.Sdk.OptionSetValue(2);$4.format.name='Hard Back';$4.price=new Xrm.Sdk.Money(9.99);this.Books.addItem($4);}this.Books.unsuspend();},getFormats:function(viewModel){var $0={};$0.name='Paper Back';$0.value=1;var $1={};$1.name='Hard Back';$1.value=2;return [$0,$1];},getLanguages:function(term,callback){if(this.$1_0==null){this.$1_0=[];this.$1_1('00000000-0000-0000-0000-000000000001','English');this.$1_1('00000000-0000-0000-0000-000000000002','French');this.$1_1('00000000-0000-0000-0000-000000000003','German');this.$1_1('00000000-0000-0000-0000-000000000004','Japanese');this.$1_1('00000000-0000-0000-0000-000000000005','Hungarian');}var $0=[];var $enum1=ss.IEnumerator.getEnumerator(this.$1_0);while($enum1.moveNext()){var $2=$enum1.current;if($2.getAttributeValueString('name').toLowerCase().indexOf(term.toLowerCase())>-1){$0.add($2);}}var $1=new Xrm.Sdk.EntityCollection($0);callback($1);},$1_1:function($p0,$p1){var $0=new Xrm.Sdk.Entity('language');$0.id=$p0;$0.setAttributeValue('name',$p1);this.$1_0.add($0);},resetCommand:function(){var $0=confirm(String.format('Are you sure you want to reset the grid? This will loose any values you have edited.'));if(!$0){return;}this.Books.suspend();this.Books.clear();this.loadBooks();this.Books.reset();this.Books.refresh();}}
Type.registerNamespace('Client.Views.InlineSubGrids');Client.Views.InlineSubGrids.ActivitySubGridView=function(){}
Client.Views.InlineSubGrids.ActivitySubGridView.init=function(){var $0=new Client.InlineSubGrids.ViewModels.ActivitySubGridViewModel();$(window).resize(function($p1_0){
Client.Views.InlineSubGrids.ActivitySubGridView.$0();});var $1=$0.viewConfig;var $2=new SparkleXrm.GridEditor.GridDataViewBinder();var $3=$2.dataBindXrmGrid($1.dataView,$1.columns,'gridcontainer','gridpager',true,false);$2.bindClickHandler($3);SparkleXrm.ViewBase.registerViewModel($0);window.setTimeout(function(){
$0.init();Client.Views.InlineSubGrids.ActivitySubGridView.$0();$3.resizeCanvas();},0);}
Client.Views.InlineSubGrids.ActivitySubGridView.$0=function(){var $0=$(window).height();var $1=$('#gridpager').height();$('#gridcontainer').height($0-$1-2);}
Client.Views.InlineSubGrids.SimpleEditableGridView=function(){}
Client.Views.InlineSubGrids.SimpleEditableGridView.init=function(){Xrm.PageEx.majorVersion=2013;$(function(){
ko.validation.registerExtenders();Xrm.Sdk.OrganizationServiceProxy.getUserSettings();var $1_0=new Client.InlineSubGrids.ViewModels.SimpleEditableGridViewModel();var $1_1=new SparkleXrm.GridEditor.GridDataViewBinder();$1_1.addCheckBoxSelectColumn=true;$1_1.selectActiveRow=true;$1_1.multiSelect=false;var $1_2=[];var $1_3=Slick.Editors.Text;SparkleXrm.GridEditor.XrmTextEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Title',150,'title'));SparkleXrm.GridEditor.XrmTextEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Author',150,'author'));SparkleXrm.GridEditor.XrmDateEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Published',150,'publishdate'),true);SparkleXrm.GridEditor.XrmMoneyEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Price',150,'price'),0,100);SparkleXrm.GridEditor.XrmNumberEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Copies',150,'numberofcopies'),0,1000,0);var $1_4=SparkleXrm.GridEditor.XrmLookupEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Language',150,'language'),ss.Delegate.create($1_0,$1_0.getLanguages),'id','name',null).options;$1_4.showImage=false;var $1_5={};$1_5.allowEmpty=true;$1_5.getOptionSetsDelegate=ss.Delegate.create($1_0,$1_0.getFormats);SparkleXrm.GridEditor.XrmOptionSetEditor.bindColumnWithOptions(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Format',150,'format'),$1_5);SparkleXrm.GridEditor.XrmDurationEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Audio Length',150,'audiolength'));SparkleXrm.GridEditor.XrmTimeEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1_2,'Start Time',150,'starttime'));var $1_6=$1_1.dataBindXrmGrid($1_0.Books,$1_2,'booksGridContainer',null,true,true);SparkleXrm.ViewBase.registerViewModel($1_0);window.setTimeout(function(){
$1_0.loadBooks();$1_6.resizeCanvas();},0);});}
Type.registerNamespace('Client.InlineSubGrids.Views');Client.InlineSubGrids.Views.ContactCardView=function(){}
Client.InlineSubGrids.Views.ContactCardView.init=function(){var $0=new Client.InlineSubGrids.ViewModels.ContactCardViewModel();Client.InlineSubGrids.Views.ContactCardView.$0=new freewall('#freewall');var $1={};$1.selector='.brick';$1.animate=true;$1.cellW=150;$1.cellH='auto';$1.onResize=function(){
Client.InlineSubGrids.Views.ContactCardView.$0.fitWidth();};Client.InlineSubGrids.Views.ContactCardView.$0.reset($1);SparkleXrm.ViewBase.registerViewModel($0);}
Client.InlineSubGrids.Views.ContactCardView.onAfterRender=function(rendered){$(rendered).find('img').load(function($p1_0){
Client.InlineSubGrids.Views.ContactCardView.$0.fitWidth();});}
Type.registerNamespace('Client.MultiEntitySearch.ViewModels');Client.MultiEntitySearch.ViewModels.MultiSearchViewModel=function(){this.searchTerm=ko.observable();this.config=ko.observableArray();Client.MultiEntitySearch.ViewModels.MultiSearchViewModel.initializeBase(this);var $0=Xrm.PageEx.getWebResourceData();var $1=[];var $2=[];if(Object.keyExists($0,'typeCodes')){$1=$0['typeCodes'].split(',');$2=$0['typeNames'].split(',');}else{$1=['1','2','4','4200','3'];$2=['account','contact','lead','activitypointer','opportunity'];}var $3="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='savedquery'>\r\n                                <attribute name='name' />\r\n                                <attribute name='fetchxml' />\r\n                                <attribute name='layoutxml' />\r\n                                <attribute name='returnedtypecode' />\r\n                                <filter type='and'>\r\n                                <filter type='or'>";var $enum1=ss.IEnumerator.getEnumerator($1);while($enum1.moveNext()){var $6=$enum1.current;$3+="<condition attribute='returnedtypecode' operator='eq' value='"+$6+"'/>";}$3+="\r\n                                    </filter>\r\n                                 <condition attribute='isquickfindquery' operator='eq' value='1'/>\r\n                                    <condition attribute='isdefault' operator='eq' value='1'/>\r\n                                </filter>\r\n                               \r\n                              </entity>\r\n                            </fetch>";var $4=Xrm.Sdk.OrganizationServiceProxy.retrieveMultiple($3);this.parser=new Client.MultiEntitySearch.ViewModels.QueryParser();var $5={};var $enum2=ss.IEnumerator.getEnumerator($4.get_entities());while($enum2.moveNext()){var $7=$enum2.current;$5[$7.getAttributeValueString('returnedtypecode')]=$7;}var $enum3=ss.IEnumerator.getEnumerator($2);while($enum3.moveNext()){var $8=$enum3.current;var $9=$5[$8];var $A=$9.getAttributeValueString('fetchxml');var $B=$9.getAttributeValueString('layoutxml');var $C=this.parser.parse($A,$B);$C.dataView=new SparkleXrm.GridEditor.EntityDataViewModel(10,Xrm.Sdk.Entity,true);this.config.push($C);}this.parser.queryDisplayNames();}
Client.MultiEntitySearch.ViewModels.MultiSearchViewModel.prototype={parser:null,getEntityDisplayName:function(index){var $0=this.config();if(index>=$0.length){return '';}else{return $0[index].rootEntity.displayCollectionName;}},searchCommand:function(){var $enum1=ss.IEnumerator.getEnumerator(this.config());while($enum1.moveNext()){var $0=$enum1.current;$0.dataView.set_fetchXml(this.parser.getFetchXmlForQuery($0,'%'+this.searchTerm()+'%'));$0.dataView.reset();$0.dataView.resetPaging();$0.dataView.refresh();}}}
Client.MultiEntitySearch.ViewModels.QueryParser=function(){this.$0={};this.$1={};this.$2={};}
Client.MultiEntitySearch.ViewModels.QueryParser.prototype={parse:function(fetchXml,layoutXml){var $0={};$0.columns=[];var $1=$('<query>'+fetchXml.replaceAll('{0}','#Query#')+'</query>');var $2=$1.find('fetch');$0.fetchXml=$1;this.$4($0);$0.columns=this.$3($0.rootEntity,layoutXml);return $0;},$3:function($p0,$p1){var $0=$($p1);var $1=$0.find('cell');var $2=[];$1.each(ss.Delegate.create(this,function($p1_0,$p1_1){
var $1_0=$p1_1.getAttribute('name').toString();var $1_1=$1_0;var $1_2;var $1_3;var $1_4=$1_0.indexOf('.');if($1_4>-1){var $1_8=$1_0.substr(0,$1_4);$1_1=$1_0.substr($1_4+1);$1_2=this.$1[$1_8];}else{$1_2=$p0;}if(Object.keyExists($1_2.attributes,$1_1)){$1_3=$1_2.attributes[$1_1];}else{$1_3={};$1_3.columns=[];$1_3.logicalName=$1_1;$1_2.attributes[$1_3.logicalName]=$1_3;}var $1_5=parseInt($p1_1.getAttribute('width').toString());var $1_6=$p1_1.getAttribute('disableSorting');var $1_7=SparkleXrm.GridEditor.GridDataViewBinder.newColumn($1_3.logicalName,$1_3.logicalName,$1_5);$1_7.sortable=!($1_6!=null&&$1_6.toString()==='1');$1_3.columns.add($1_7);$2.add($1_7);}));return $2;},queryDisplayNames:function(){var $0=new Xrm.Sdk.Metadata.Query.MetadataQueryBuilder();var $1=[];var $2=[];var $enum1=ss.IEnumerator.getEnumerator(Object.keys(this.$0));while($enum1.moveNext()){var $4=$enum1.current;$1.add($4);var $5=this.$0[$4];var $enum2=ss.IEnumerator.getEnumerator(Object.keys($5.attributes));while($enum2.moveNext()){var $6=$enum2.current;var $7=$5.attributes[$6];var $8=$7.logicalName;var $9=$8.indexOf('.');if($5.aliasName!=null&&$9>-1){$8=$8.substr($9);}$2.add($8);}}$0.addEntities($1,['Attributes','DisplayName','DisplayCollectionName']);$0.addAttributes($2,['DisplayName','AttributeType','IsPrimaryName']);$0.setLanguage(USER_LANGUAGE_CODE);var $3=Xrm.Sdk.OrganizationServiceProxy.execute($0.request);var $enum3=ss.IEnumerator.getEnumerator($3.entityMetadata);while($enum3.moveNext()){var $A=$enum3.current;var $B=this.$0[$A.logicalName];$B.displayName=$A.displayName.userLocalizedLabel.label;$B.displayCollectionName=$A.displayCollectionName.userLocalizedLabel.label;var $enum4=ss.IEnumerator.getEnumerator($A.attributes);while($enum4.moveNext()){var $C=$enum4.current;if(Object.keyExists($B.attributes,$C.logicalName)){var $D=$B.attributes[$C.logicalName];$D.attributeType=$C.attributeType;switch($C.attributeType){case 'Lookup':case 'Picklist':case 'Customer':case 'Owner':case 'Status':case 'State':case 'Boolean':this.$2[$C.logicalName]=$D;break;}$D.isPrimaryName=$C.isPrimaryName;var $enum5=ss.IEnumerator.getEnumerator($D.columns);while($enum5.moveNext()){var $E=$enum5.current;$E.name=$C.displayName.userLocalizedLabel.label;$E.dataType=($C.isPrimaryName)?'PrimaryNameLookup':$C.attributeType;}}}}},$4:function($p0){var $0=$p0.fetchXml;var $1=$0.find('entity');var $2=$1.attr('name');var $3;if(!Object.keyExists(this.$0,$2)){$3={};$3.logicalName=$2;$3.attributes={};this.$0[$3.logicalName]=$3;}else{$3=this.$0[$2];}var $4=$1.find('link-entity');$4.each(ss.Delegate.create(this,function($p1_0,$p1_1){
var $1_0={};$1_0.attributes={};$1_0.aliasName=$p1_1.getAttribute('alias').toString();$1_0.logicalName=$p1_1.getAttribute('name').toString();if(!Object.keyExists(this.$0,$1_0.logicalName)){this.$0[$1_0.logicalName]=$1_0;}else{var $1_1=$1_0.aliasName;$1_0=this.$0[$1_0.logicalName];$1_0.aliasName=$1_1;}if(!Object.keyExists(this.$1,$1_0.aliasName)){this.$1[$1_0.aliasName]=$1_0;}}));$p0.rootEntity=$3;},getFetchXmlForQuery:function(config,searchTerm){var $0=config.fetchXml.find('fetch');$0.attr('count','{0}');$0.attr('paging-cookie','{1}');$0.attr('page','{2}');$0.attr('returntotalrecordcount','true');$0.attr('distinct','true');$0.attr('no-lock','true');var $1=$0.find('order');$1.remove();var $2=$0.find("filter[isquickfindfields='1']");$2.first().children().each(ss.Delegate.create(this,function($p1_0,$p1_1){
var $1_0=$p1_1.getAttribute('attribute').toString();if(Object.keyExists(this.$2,$1_0)){$p1_1.setAttribute('attribute',$1_0+'name');}}));var $3=config.fetchXml.html().replaceAll('</entity>','{3}</entity>');$3=$3.replaceAll('#Query#',Xrm.Sdk.XmlHelper.encode(searchTerm));return $3;}}
Type.registerNamespace('Client.MultiEntitySearch.Views');Client.MultiEntitySearch.Views.MultiSearchView=function(){}
Client.MultiEntitySearch.Views.MultiSearchView.init=function(){var $0=new Client.MultiEntitySearch.ViewModels.MultiSearchViewModel();var $1=$0.config();var $2=0;var $enum1=ss.IEnumerator.getEnumerator($1);while($enum1.moveNext()){var $3=$enum1.current;var $4=new SparkleXrm.GridEditor.GridDataViewBinder();var $5=$4.dataBindXrmGrid($3.dataView,$3.columns,'grid'+$2.toString()+'container','grid'+$2.toString()+'pager',true,false);$4.bindClickHandler($5);$2++;}SparkleXrm.ViewBase.registerViewModel($0);}
Type.registerNamespace('Client.QuoteLineItemEditor.Model');Client.QuoteLineItemEditor.Model.QuoteDetail=function(){Client.QuoteLineItemEditor.Model.QuoteDetail.initializeBase(this,['quotedetail']);this._metaData['quantity']=Xrm.Sdk.AttributeTypes.decimal_;this._metaData['lineitemnumber']=Xrm.Sdk.AttributeTypes.int_;this.add_propertyChanged(ss.Delegate.create(this,this.$1_0));}
Client.QuoteLineItemEditor.Model.QuoteDetail.prototype={quotedetailid:null,quoteid:null,lineitemnumber:null,isproductoverridden:false,productdescription:null,productid:null,uomid:null,ispriceoverridden:false,priceperunit:null,quantity:null,extendedamount:null,transactioncurrencyid:null,requestdeliveryby:null,salesrepid:null,$1_0:function($p0,$p1){if(this.quantity!=null&&this.priceperunit!=null){this.extendedamount=new Xrm.Sdk.Money(this.quantity*this.priceperunit.value);}this.isproductoverridden=!String.isNullOrEmpty(this.productdescription);}}
Type.registerNamespace('Client.QuoteLineItemEditor.ViewModels');Client.QuoteLineItemEditor.ViewModels.ObservableQuoteDetail=function(){this.requestdeliveryby=ko.observable();this.salesrepid=ko.observable();this.requestdeliveryby.subscribe(ss.Delegate.create(this,function($p1_0){
this.onValueChange('requestdeliveryby',$p1_0);}));this.salesrepid.subscribe(ss.Delegate.create(this,function($p1_0){
this.onValueChange('salesrepid',$p1_0);}));}
Client.QuoteLineItemEditor.ViewModels.ObservableQuoteDetail.prototype={$0:false,innerQuoteDetail:null,onValueChange:function(attribute,newValue){if(!this.$0){window.setTimeout(ss.Delegate.create(this,function(){
this.commit();}),0);}},setValue:function(value){this.$0=true;this.innerQuoteDetail=(value==null)?new Client.QuoteLineItemEditor.Model.QuoteDetail():value;this.requestdeliveryby(this.innerQuoteDetail.requestdeliveryby);this.salesrepid(this.innerQuoteDetail.salesrepid);this.$0=false;},commit:function(){if(this.innerQuoteDetail==null){return null;}this.innerQuoteDetail.requestdeliveryby=ko.utils.unwrapObservable(this.requestdeliveryby);this.innerQuoteDetail.salesrepid=ko.utils.unwrapObservable(this.salesrepid);this.innerQuoteDetail.raisePropertyChanged('');return this.innerQuoteDetail;}}
Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation=function(){}
Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.writeInProduct=function(rules,viewModel,dataContext){var $0=ko.utils.unwrapObservable(viewModel);return rules.addRule('Select either a product or provide a product description.',function($p1_0){
var $1_0=ko.utils.unwrapObservable($0.productid);var $1_1=String.isNullOrEmpty($p1_0)||($1_0==null);return $1_1;});}
Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.productId=function(rules,viewModel,dataContext){var $0=ko.utils.unwrapObservable(viewModel);return rules.addRule('Select either a product or provide a product description.',function($p1_0){
var $1_0=ko.utils.unwrapObservable($0.productdescription);var $1_1=String.isNullOrEmpty($1_0)||($p1_0==null);return $1_1;});}
Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.register=function(binder){binder.register('productdescription',Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.writeInProduct);binder.register('productid',Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.productId);}
Client.QuoteLineItemEditor.ViewModels.QuoteLineItemEditorViewModel=function(){this.selectedQuoteDetail=ko.observable();Client.QuoteLineItemEditor.ViewModels.QuoteLineItemEditorViewModel.initializeBase(this);this.lines=new SparkleXrm.GridEditor.EntityDataViewModel(10,Client.QuoteLineItemEditor.Model.QuoteDetail,false);this.lines.add_onSelectedRowsChanged(ss.Delegate.create(this,this.$1_1));this.lines.set_fetchXml("<fetch version='1.0' output-format='xml-platform' mapping='logical' returntotalrecordcount='true' no-lock='true' distinct='false' count='{0}' paging-cookie='{1}' page='{2}'>\r\n                              <entity name='quotedetail'>\r\n                                <attribute name='productid' />\r\n                                <attribute name='productdescription' />\r\n                                <attribute name='priceperunit' />\r\n                                <attribute name='quantity' />\r\n                                <attribute name='extendedamount' />\r\n                                <attribute name='quotedetailid' />\r\n                                <attribute name='isproductoverridden' />\r\n                                <attribute name='ispriceoverridden' />\r\n                                <attribute name='manualdiscountamount' />\r\n                                <attribute name='lineitemnumber' />\r\n                                <attribute name='description' />\r\n                                <attribute name='transactioncurrencyid' />\r\n                                <attribute name='baseamount' />\r\n                                <attribute name='requestdeliveryby' />\r\n                                <attribute name='salesrepid' />\r\n                                <attribute name='uomid' />\r\n                                {3}\r\n                                <link-entity name='quote' from='quoteid' to='quoteid' alias='ac'>\r\n                                  <filter type='and'>\r\n                                    <condition attribute='quoteid' operator='eq' uiname='tes' uitype='quote' value='"+this.getQuoteId()+"' />\r\n                                  </filter>\r\n                                </link-entity>\r\n                              </entity>\r\n                            </fetch>");this.lines.sortBy(new SparkleXrm.GridEditor.SortCol('lineitemnumber',true));this.lines.newItemFactory=ss.Delegate.create(this,this.newLineFactory);Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.register(this.lines.validationBinder);this.selectedQuoteDetail(new Client.QuoteLineItemEditor.ViewModels.ObservableQuoteDetail());}
Client.QuoteLineItemEditor.ViewModels.QuoteLineItemEditorViewModel.prototype={lines:null,$1_0:null,isEditForm:function(){if(window.parent.Xrm.Page.ui!=null){return (window.parent.Xrm.Page.ui.getFormType()===10*.2);}else{return true;}},getQuoteId:function(){var $0='DB040ECD-5ED4-E211-9BE0-000C299FFE7D';if(window.parent.Xrm.Page.ui!=null){var $1=window.parent.Xrm.Page.data.entity.getId();if($1!=null){$0=$1.replaceAll('{','').replaceAll('}','');}this.$1_0=(window.parent.Xrm.Page.getAttribute('transactioncurrencyid').getValue())[0].id;}return $0;},newLineFactory:function(item){var $0=new Client.QuoteLineItemEditor.Model.QuoteDetail();$.extend($0,item);$0.lineitemnumber=this.lines.getPagingInfo().totalRows+1;$0.quoteid=new Xrm.Sdk.EntityReference(new Xrm.Sdk.Guid(this.getQuoteId()),'quote',null);if(this.$1_0!=null){$0.transactioncurrencyid=new Xrm.Sdk.EntityReference(new Xrm.Sdk.Guid(this.$1_0),'transactioncurrency','');}return $0;},$1_1:function(){var $0=this.lines.getSelectedRows();if($0.length>0){var $1=this.selectedQuoteDetail();if($1.innerQuoteDetail!=null){$1.innerQuoteDetail.remove_propertyChanged(ss.Delegate.create(this,this.$1_2));}var $2=this.lines.getItem($0[0].fromRow);if($2!=null){$2.add_propertyChanged(ss.Delegate.create(this,this.$1_2));}this.selectedQuoteDetail().setValue($2);}else{this.selectedQuoteDetail().setValue(null);}},$1_2:function($p0,$p1){window.setTimeout(ss.Delegate.create(this,function(){
this.lines.refresh();}),0);},productSearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='product'>\r\n                                <attribute name='productid' />\r\n                                <attribute name='name' />\r\n                                <order attribute='name' descending='false' />\r\n                                <filter type='and'>\r\n                                  <condition attribute='name' operator='like' value='%{0}%' />\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},uoMSearchCommand:function(term,callback){var $0=" <fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                                  <entity name='uom'>\r\n                                    <attribute name='uomid' />\r\n                                    <attribute name='name' />\r\n                                    <order attribute='name' descending='false' />\r\n                                    <filter type='and'>\r\n                                      <condition attribute='name' operator='like' value='%{0}%' />\r\n                                    </filter>\r\n                                  </entity>\r\n                                </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},salesRepSearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                                  <entity name='systemuser'>\r\n                                    <attribute name='fullname' />\r\n                                    <attribute name='businessunitid' />\r\n                                    <attribute name='title' />\r\n                                    <attribute name='address1_telephone1' />\r\n                                    <attribute name='systemuserid' />\r\n                                    <order attribute='fullname' descending='false' />\r\n                                    <filter type='and'>\r\n                                      <condition attribute='fullname' operator='like' value='%{0}%' />\r\n                                    </filter>\r\n                                  </entity>\r\n                                </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},$1_3:function($p0,$p1,$p2){var $0=$p0[0];if($0.entityState===Xrm.Sdk.EntityStates.deleted){Xrm.Sdk.OrganizationServiceProxy.beginDelete('quotedetail',$0.quotedetailid,ss.Delegate.create(this,function($p1_0){
try{Xrm.Sdk.OrganizationServiceProxy.endDelete($p1_0);$0.entityState=Xrm.Sdk.EntityStates.unchanged;}catch($1_0){$p1.add($1_0.message);}this.$1_4($p0,$p1,$p2,$0);}));}else if($0.quotedetailid==null){Xrm.Sdk.OrganizationServiceProxy.beginCreate($0,ss.Delegate.create(this,function($p1_0){
try{var $1_0=Xrm.Sdk.OrganizationServiceProxy.endCreate($p1_0);$0.quotedetailid=$1_0;$0.entityState=Xrm.Sdk.EntityStates.unchanged;}catch($1_1){$p1.add($1_1.message);}this.$1_4($p0,$p1,$p2,$0);}));}else{Xrm.Sdk.OrganizationServiceProxy.beginUpdate($0,ss.Delegate.create(this,function($p1_0){
try{Xrm.Sdk.OrganizationServiceProxy.endUpdate($p1_0);$0.entityState=Xrm.Sdk.EntityStates.unchanged;}catch($1_0){$p1.add($1_0.message);}this.$1_4($p0,$p1,$p2,$0);}));}},$1_4:function($p0,$p1,$p2,$p3){$p0.remove($p3);if(!$p0.length){$p2();}else{this.$1_3($p0,$p1,$p2);}},$1_5:null,saveCommand:function(){if(this.$1_5==null){this.$1_5=ss.Delegate.create(this,function(){
if(!this.commitEdit()){return;}var $1_0=[];var $enum1=ss.IEnumerator.getEnumerator(this.lines.get_data());while($enum1.moveNext()){var $1_4=$enum1.current;if($1_4!=null&&$1_4.entityState!==Xrm.Sdk.EntityStates.unchanged){$1_0.add($1_4);}}if(this.lines.deleteData!=null){var $enum2=ss.IEnumerator.getEnumerator(this.lines.deleteData);while($enum2.moveNext()){var $1_5=$enum2.current;if($1_5.entityState===Xrm.Sdk.EntityStates.deleted){$1_0.add($1_5);}}}var $1_1=$1_0.length;if(!$1_1){return;}var $1_2=confirm(String.format('Are you sure that you want to save the {0} quote lines in the Grid?',$1_1));if(!$1_2){return;}this.isBusy(true);var $1_3=[];this.$1_3($1_0,$1_3,ss.Delegate.create(this,function(){
if($1_3.length>0){alert('One or more records failed to save.\nPlease contact your System Administrator.\n\n'+$1_3.join(','));}if(this.lines.deleteData!=null){this.lines.deleteData.clear();}this.lines.refresh();this.isBusy(false);}));});}return this.$1_5;},$1_6:null,deleteCommand:function(){if(this.$1_6==null){this.$1_6=ss.Delegate.create(this,function(){
var $1_0=SparkleXrm.GridEditor.DataViewBase.rangesToRows(this.lines.getSelectedRows());if(!$1_0.length){return;}var $1_1=confirm(String.format('Are you sure that you want to delete the {0} quote lines in the Grid?',$1_0.length));if(!$1_1){return;}var $1_2=[];var $enum1=ss.IEnumerator.getEnumerator($1_0);while($enum1.moveNext()){var $1_3=$enum1.current;$1_2.add(this.lines.getItem($1_3));}var $enum2=ss.IEnumerator.getEnumerator($1_2);while($enum2.moveNext()){var $1_4=$enum2.current;$1_4.entityState=Xrm.Sdk.EntityStates.deleted;this.lines.removeItem($1_4);}this.lines.refresh();});}return this.$1_6;},$1_7:null,moveUpCommand:function(){if(this.$1_7==null){this.$1_7=ss.Delegate.create(this,function(){
var $1_0=this.lines.getSelectedRows();var $1_1=$1_0[0].fromRow;if(!$1_1){return;}var $1_2=this.lines.getItem($1_1);var $1_3=this.lines.getItem($1_1-1);var $1_4=$1_2.lineitemnumber;$1_2.lineitemnumber=$1_3.lineitemnumber;$1_3.lineitemnumber=$1_4;$1_2.raisePropertyChanged('LineItemNumber');$1_3.raisePropertyChanged('LineItemNumber');$1_0[0].fromRow--;this.lines.raiseOnSelectedRowsChanged($1_0);this.lines.sortBy(new SparkleXrm.GridEditor.SortCol('lineitemnumber',true));this.lines.refresh();});}return this.$1_7;},$1_8:null,moveDownCommand:function(){if(this.$1_8==null){this.$1_8=ss.Delegate.create(this,function(){
var $1_0=this.lines.getSelectedRows();var $1_1=$1_0[0].fromRow;if($1_1===this.lines.getLength()-1){return;}var $1_2=this.lines.getItem($1_1);var $1_3=this.lines.getItem($1_1+1);var $1_4=$1_2.lineitemnumber;$1_2.raisePropertyChanged('LineItemNumber');$1_3.raisePropertyChanged('LineItemNumber');$1_2.lineitemnumber=$1_3.lineitemnumber;$1_3.lineitemnumber=$1_4;$1_0[0].fromRow++;this.lines.raiseOnSelectedRowsChanged($1_0);this.lines.sortBy(new SparkleXrm.GridEditor.SortCol('lineitemnumber',true));this.lines.refresh();});}return this.$1_8;}}
Type.registerNamespace('Client.QuoteLineItemEditor.Views');Client.QuoteLineItemEditor.Views.QuoteLineItemEditorView=function(){Client.QuoteLineItemEditor.Views.QuoteLineItemEditorView.initializeBase(this);}
Client.QuoteLineItemEditor.Views.QuoteLineItemEditorView.init=function(){var $0=new Client.QuoteLineItemEditor.ViewModels.QuoteLineItemEditorViewModel();var $1=[];SparkleXrm.GridEditor.GridDataViewBinder.addEditIndicatorColumn($1);SparkleXrm.GridEditor.XrmNumberEditor.bindReadOnlyColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'#',40,'lineitemnumber'),0);SparkleXrm.GridEditor.XrmLookupEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Existing Product',200,'productid'),ss.Delegate.create($0,$0.productSearchCommand),'productid','name','');SparkleXrm.GridEditor.XrmLookupEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Units',100,'uomid'),ss.Delegate.create($0,$0.uoMSearchCommand),'uomid','name','');SparkleXrm.GridEditor.XrmTextEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Write-In Product',200,'productdescription'));SparkleXrm.GridEditor.XrmMoneyEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Price Per Unit',200,'priceperunit'),0,1000);SparkleXrm.GridEditor.XrmNumberEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Quantity',200,'quantity'),0,1000,2);SparkleXrm.GridEditor.XrmMoneyEditor.bindReadOnlyColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Extended Amount',100,'extendedamount'));var $2=new SparkleXrm.GridEditor.GridDataViewBinder();var $3=$2.dataBindXrmGrid($0.lines,$1,'quoteproductGrid','quoteproductPager',true,true);$2.bindCommitEdit($0);SparkleXrm.ViewBase.registerViewModel($0);window.setTimeout(function(){
$0.lines.refresh();},0);}
Type.registerNamespace('Client.ScheduledJobsEditor.Model');Client.ScheduledJobsEditor.Model.BulkDeleteOperation=function(){Client.ScheduledJobsEditor.Model.BulkDeleteOperation.initializeBase(this,['bulkdeleteoperation']);}
Client.ScheduledJobsEditor.Model.BulkDeleteOperation.prototype={name:null,bulkdeleteoperationid:null,asyncoperationid:null,asyncoperation_statecode:null,asyncoperation_statuscode:null,asyncoperation_postponeuntil:null}
Client.ScheduledJobsEditor.Model.dev1_ScheduledJob=function(){Client.ScheduledJobsEditor.Model.dev1_ScheduledJob.initializeBase(this,['dev1_scheduledjob']);}
Client.ScheduledJobsEditor.Model.dev1_ScheduledJob.prototype={dev1_scheduledjobid:null,dev1_name:null,dev1_recurrancepattern:null,createdon:null,dev1_workflowname:null,dev1_startdate:null}
Client.ScheduledJobsEditor.Model.asyncoperation=function(){Client.ScheduledJobsEditor.Model.asyncoperation.initializeBase(this,['asyncoperation']);}
Client.ScheduledJobsEditor.Model.asyncoperation.prototype={asyncoperationid:null,name:null,recurrencepattern:null,postponeuntil:null,recurrencestarttime:null,bulkdeleteoperationid:null,data:null,statecode:null,statuscode:null}
Type.registerNamespace('Client.ScheduledJobsEditor.ViewModels');Client.ScheduledJobsEditor.ViewModels.ScheduledJob=function(){this.scheduledJobId=ko.observable();this.name=ko.observable();this.startDate=ko.observable();this.startTime=ko.observable();this.endTime=ko.observable();this.recurrance=ko.observable();this.data=ko.observable();this.recurEvery=ko.observable(0);this.sunday=ko.observable(false);this.monday=ko.observable(false);this.tuesday=ko.observable(false);this.wednesday=ko.observable(false);this.thursday=ko.observable(false);this.friday=ko.observable(false);this.saturday=ko.observable(false);this.count=ko.observable();this.noEndDate=ko.observable(true);this.recurrancePattern=ko.observable();this.workflowId=ko.observable();this.addValidation();}
Client.ScheduledJobsEditor.ViewModels.ScheduledJob.prototype={reset:function(){this.scheduledJobId(null);this.name('');this.workflowId(null);this.monday(false);this.tuesday(false);this.wednesday(false);this.thursday(false);this.friday(false);this.saturday(false);this.sunday(false);this.startDate(Date.get_now());this.recurEvery(1);this.recurrance(Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.get_recurranceFrequencies()[0]);},addValidation:function(){var $0=this;SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the name of the scheduled job').register(this.name);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the name of the workflow to run').register(this.workflowId);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the start date of the scheduled').register(this.startDate);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the recurrance frequency of the job').register(this.recurrance);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the interval of the recurrance.').addRule('Interval must be greater than zero',function($p1_0){
if(!String.isNullOrEmpty($p1_0.toString())){return (parseInt($p1_0.toString())>0);}else{return true;}}).register(this.recurEvery);}}
Client.ScheduledJobsEditor.ViewModels.ScheduledJobsEditorViewModel=function(){this.jobsViewModel=new SparkleXrm.GridEditor.EntityDataViewModel(2,Xrm.Sdk.Entity,true);this.bulkDeleteJobsViewModel=new SparkleXrm.GridEditor.EntityDataViewModel(10,Xrm.Sdk.Entity,true);this.recurranceFrequencies=Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.get_recurranceFrequencies();this.selectedJob=ko.validatedObservable(new Client.ScheduledJobsEditor.ViewModels.ScheduledJob());Client.ScheduledJobsEditor.ViewModels.ScheduledJobsEditorViewModel.initializeBase(this);var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' returntotalrecordcount='true' no-lock='true' distinct='false' count='{0}' paging-cookie='{1}' page='{2}'>\r\n                              <entity name='dev1_scheduledjob'>\r\n                                <attribute name='dev1_scheduledjobid' />\r\n                                <attribute name='dev1_name' />\r\n                                <attribute name='createdon' />\r\n                                <attribute name='dev1_workflowname' />\r\n                                <attribute name='dev1_recurrancepattern' />\r\n                                <attribute name='dev1_startdate' />\r\n                                <attribute name='dev1_enabled' />\r\n                                {3}\r\n                              </entity>\r\n                            </fetch>";this.jobsViewModel.set_fetchXml($0);this.jobsViewModel.add_onSelectedRowsChanged(ss.Delegate.create(this,this.$1_0));}
Client.ScheduledJobsEditor.ViewModels.ScheduledJobsEditorViewModel.prototype={$1_0:function(){var $0=this.jobsViewModel.getSelectedRows();if($0.length>0){var $1=this.selectedJob();var $2=this.jobsViewModel.getItem($0[0].fromRow);$1.recurrancePattern($2.dev1_recurrancepattern);Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.deSerialise($1,$2.dev1_recurrancepattern);$1.scheduledJobId($2.dev1_scheduledjobid);$1.name($2.dev1_name);$1.startDate($2.dev1_startdate);$1.recurrancePattern($2.dev1_recurrancepattern);var $3=new Xrm.Sdk.EntityReference(null,null,$2.dev1_workflowname);$1.workflowId($3);var $4="<fetch version='1.0' output-format='xml-platform' mapping='logical' returntotalrecordcount='true' no-lock='true' distinct='false' count='{0}' paging-cookie='{1}' page='{2}'>\r\n                            <entity name='bulkdeleteoperation'>\r\n                            <attribute name='name' />\r\n                            <attribute name='createdon' />\r\n                            <attribute name='asyncoperationid' />\r\n                            <filter type='and'>\r\n                            <condition attribute='name' operator='like' value='%"+$2.dev1_scheduledjobid.value+"%' />\r\n                            </filter>\r\n                            <link-entity name='asyncoperation' to='asyncoperationid' from='asyncoperationid' link-type='inner' alias='a0'>\r\n                            <attribute name='postponeuntil' alias='asyncoperation_postponeuntil' />\r\n                            <attribute name='statecode' alias='asyncoperation_statecode' />\r\n                            <attribute name='statuscode'  alias='asyncoperation_statuscode' />\r\n                            <attribute name='recurrencepattern'  alias='asyncoperation_recurrencepattern' />\r\n                            </link-entity>{3}\r\n                            </entity>\r\n                            </fetch>";this.bulkDeleteJobsViewModel.set_fetchXml($4);this.bulkDeleteJobsViewModel.reset();this.bulkDeleteJobsViewModel.refresh();}},workflowSearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='workflow'>\r\n                                <attribute name='workflowid' />\r\n                                <attribute name='name' />\r\n                                <order attribute='modifiedon' descending='false' />\r\n                                <filter type='and'>\r\n                                    <condition attribute='name' operator='like' value='%{0}%' />\r\n                                    <condition attribute='type' value='1' operator='eq'/>\r\n                                    <condition attribute='category' value='0' operator='eq'/>\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},$1_1:null,deleteCommand:function(){if(this.$1_1==null){this.$1_1=ss.Delegate.create(this,function(){
var $1_0=this.jobsViewModel.getSelectedRows();var $1_1=SparkleXrm.GridEditor.DataViewBase.rangesToRows($1_0);var $1_2=confirm(String.format('Are you sure you want to delete these {0} job(s)?',$1_1.length));if(!$1_2){return;}this.isBusy(true);Xrm.DelegateItterator.callbackItterate(ss.Delegate.create(this,function($p2_0,$p2_1,$p2_2){
var $2_0=this.jobsViewModel.getItem($1_1[$p2_0]);this.$1_4($2_0.dev1_scheduledjobid,ss.Delegate.create(this,function(){
Xrm.Sdk.OrganizationServiceProxy.beginDelete(Client.ScheduledJobsEditor.Model.dev1_ScheduledJob.entityLogicalName,$2_0.dev1_scheduledjobid,ss.Delegate.create(this,function($p4_0){
try{Xrm.Sdk.OrganizationServiceProxy.endDelete($p4_0);this.isBusyProgress(($p2_0/$1_1.length)*100);$p2_1();}catch($4_0){$p2_2($4_0);}}));}));}),$1_1.length,ss.Delegate.create(this,function(){
this.isBusy(false);this.jobsViewModel.reset();this.jobsViewModel.refresh();}),ss.Delegate.create(this,function($p2_0){
this.$1_8($p2_0);}));});}return this.$1_1;},$1_2:null,newCommand:function(){if(this.$1_2==null){this.$1_2=ss.Delegate.create(this,function(){
var $1_0=new Array(0);this.jobsViewModel.raiseOnSelectedRowsChanged($1_0);var $1_1=this.selectedJob();$1_1.reset();});}return this.$1_2;},$1_3:null,saveCommand:function(){if(this.$1_3==null){this.$1_3=ss.Delegate.create(this,function(){
if(!(this.selectedJob).isValid()){var $1_3=ko.validation.group(this.selectedJob());$1_3.showAllMessages(true);return;}var $1_0=confirm(String.format('Are you sure you want to save this schedule?'));if(!$1_0){return;}this.isBusy(true);this.isBusyProgress(0);this.isBusyMessage('Saving...');var $1_1=new Client.ScheduledJobsEditor.Model.dev1_ScheduledJob();var $1_2=this.selectedJob();$1_1.dev1_name=$1_2.name();$1_1.dev1_startdate=$1_2.startDate();$1_1.dev1_workflowname=$1_2.workflowId().name;$1_1.dev1_recurrancepattern=Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.serialise($1_2);if($1_2.scheduledJobId()==null){Xrm.Sdk.OrganizationServiceProxy.beginCreate($1_1,ss.Delegate.create(this,function($p2_0){
try{$1_2.scheduledJobId(Xrm.Sdk.OrganizationServiceProxy.endCreate($p2_0));this.$1_6($1_2);}catch($2_0){this.$1_8($2_0);}}));}else{$1_1.dev1_scheduledjobid=$1_2.scheduledJobId();Xrm.Sdk.OrganizationServiceProxy.beginUpdate($1_1,ss.Delegate.create(this,function($p2_0){
try{Xrm.Sdk.OrganizationServiceProxy.endUpdate($p2_0);this.$1_4($1_2.scheduledJobId(),ss.Delegate.create(this,function(){
this.$1_6($1_2);}));}catch($2_0){this.$1_8($2_0);}}));}});}return this.$1_3;},$1_4:function($p0,$p1){this.isBusyMessage('Deleting existing schedule...');var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>"+"<entity name='bulkdeleteoperation'>"+"<attribute name='name' />"+"<attribute name='asyncoperationid' />"+"<link-entity name='asyncoperation' alias='a0' to='asyncoperationid' from='asyncoperationid'>"+"<attribute name='statecode' alias='asyncoperation_statecode'/>"+"<attribute name='statuscode'  alias='asyncoperation_statuscode'/>"+'</link-entity>'+"<filter type='and'>"+"<condition attribute='name' operator='like' value='%"+$p0.toString()+"%' />"+'</filter>'+'</entity>'+'</fetch>';Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,ss.Delegate.create(this,function($p1_0){
try{var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Client.ScheduledJobsEditor.Model.BulkDeleteOperation);var $1_1=[];this.isBusyProgress(0);var $enum1=ss.IEnumerator.getEnumerator($1_0.get_entities());while($enum1.moveNext()){var $1_2=$enum1.current;var $1_3=new Client.ScheduledJobsEditor.ViewModels.PendingDelete();$1_3.entityName=Client.ScheduledJobsEditor.Model.BulkDeleteOperation.entityLogicalName;$1_3.id=$1_2.bulkdeleteoperationid;Xrm.ArrayEx.add($1_1,$1_3);var $1_4=new Client.ScheduledJobsEditor.ViewModels.PendingDelete();$1_4.entityName=Client.ScheduledJobsEditor.Model.asyncoperation.entityLogicalName;$1_4.id=$1_2.asyncoperationid.id;$1_4.cancelFirst=($1_2.asyncoperation_statecode.value===1);Xrm.ArrayEx.add($1_1,$1_4);}this.$1_5($1_1,$p1);}catch($1_5){this.$1_8($1_5);}}));},$1_5:function($p0,$p1){Xrm.DelegateItterator.callbackItterate(ss.Delegate.create(this,function($p1_0,$p1_1,$p1_2){
var $1_0=$p0[$p1_0];if($1_0.cancelFirst){var $1_1=new Client.ScheduledJobsEditor.Model.asyncoperation();$1_1.asyncoperationid=$1_0.id;$1_1.id=$1_1.asyncoperationid.value;$1_1.statecode=new Xrm.Sdk.OptionSetValue(3);Xrm.Sdk.OrganizationServiceProxy.update($1_1);}Xrm.Sdk.OrganizationServiceProxy.beginDelete($1_0.entityName,$1_0.id,ss.Delegate.create(this,function($p2_0){
try{Xrm.Sdk.OrganizationServiceProxy.endDelete($p2_0);this.isBusyProgress(($p1_0/$p0.length)*100);$p1_1();}catch($2_0){$p1_2($2_0);}}));}),$p0.length,$p1,ss.Delegate.create(this,function($p1_0){
this.$1_8($p1_0);}));},$1_6:function($p0){this.isBusyMessage('Creating new schedule...');this.isBusyProgress(0);var $0="<fetch distinct='false' no-lock='false' mapping='logical'><entity name='lead'><attribute name='fullname' /><attribute name='statuscode' /><attribute name='createdon' /><attribute name='subject' /><attribute name='leadid' /><filter type='and'><condition attribute='ownerid' operator='eq-userid' /><condition attribute='statecode' operator='eq' value='0' /><condition attribute='address1_county' operator='eq' value='deleteme' /></filter><order attribute='createdon' descending='true' /></entity></fetch>";var $1=new Xrm.Sdk.Messages.FetchXmlToQueryExpressionRequest();$1.fetchXml=$0;Xrm.Sdk.OrganizationServiceProxy.beginExecute($1,ss.Delegate.create(this,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endExecute($p1_0);var $1_1=[];if($p0.recurrance().value!=='DAILY'){var $1_2=Xrm.Sdk.DateTimeEx.utcToLocalTimeFromSettings($p0.startDate(),Xrm.Sdk.OrganizationServiceProxy.getUserSettings());var $1_3='days';var $1_4=1;var $1_5=1;var $1_6=0;var $1_7=0;var $1_8='DAILY';switch($p0.recurrance().value){case 'MINUTELY':$1_3='minutes';$1_4=$p0.recurEvery();$1_5=1;$1_6=(60*24)/$1_4;break;case 'HOURLY':$1_3='hours';$1_4=$p0.recurEvery();$1_5=1;$1_6=24/$1_4;break;case 'WEEKLY':case 'YEARLY':throw new Error('The selected schedule interval is currently not supported due to the limitation of bulk delete');}if($1_4<0){throw new Error('Invalid schedule');}for(var $1_9=0;$1_9<$1_6;$1_9++){var $1_A=new Xrm.Sdk.Messages.BulkDeleteRequest();$1_A.querySet=$1_0.query.replaceAll('<d:anyType ','<d:anyType xmlns:e="http://www.w3.org/2001/XMLSchema" ');$1_A.sendEmailNotification=false;$1_A.startDateTime=$1_2;$1_A.recurrencePattern='FREQ=DAILY;INTERVAL='+$1_5.toString();$1_A.jobName='Scheduled Job '+$1_9.format('0000')+' '+$p0.scheduledJobId().value;Xrm.ArrayEx.add($1_1,$1_A);$1_2=Xrm.Sdk.DateTimeEx.dateAdd($1_3,$1_4,$1_2);}}else{var $1_B=new Xrm.Sdk.Messages.BulkDeleteRequest();$1_B.querySet=$1_0.query.replaceAll('<d:anyType ','<d:anyType xmlns:e="http://www.w3.org/2001/XMLSchema" ');$1_B.sendEmailNotification=false;$1_B.startDateTime=$p0.startDate();$1_B.recurrencePattern=Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.serialise($p0);$1_B.jobName='Scheduled Job '+$p0.scheduledJobId().value;Xrm.ArrayEx.add($1_1,$1_B);}this.$1_7($1_1,ss.Delegate.create(this,function(){
this.isBusy(false);this.jobsViewModel.reset();this.jobsViewModel.refresh();}));}));},$1_7:function($p0,$p1){Xrm.DelegateItterator.callbackItterate(ss.Delegate.create(this,function($p1_0,$p1_1,$p1_2){
var $1_0=$p0[$p1_0];Xrm.Sdk.OrganizationServiceProxy.beginExecute($1_0,ss.Delegate.create(this,function($p2_0){
try{Xrm.Sdk.OrganizationServiceProxy.endExecute($p2_0);this.isBusyProgress(($p1_0/$p0.length)*100);$p1_1();}catch($2_0){$p1_2($2_0);}}));}),$p0.length,$p1,ss.Delegate.create(this,function($p1_0){
this.$1_8($p1_0);}));},$1_8:function($p0){debugger;alert('There was a problem saving. Please contact your system administrator.\n\n'+$p0.message);this.isBusy(false);this.jobsViewModel.reset();this.jobsViewModel.refresh();}}
Client.ScheduledJobsEditor.ViewModels.PendingDelete=function(){}
Client.ScheduledJobsEditor.ViewModels.PendingDelete.prototype={entityName:null,id:null,cancelFirst:false}
Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames=function(){}
Client.ScheduledJobsEditor.ViewModels.DayNames=function(){}
Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper=function(){}
Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.get_recurranceFrequencies=function(){if(Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper._frequencies==null){var $0=new Array(5);$0[0]={};$0[0].value='YEARLY';$0[0].name='Yearly';$0[1]={};$0[1].value='WEEKLY';$0[1].name='Week';$0[2]={};$0[2].value='DAILY';$0[2].name='Day';$0[3]={};$0[3].value='HOURLY';$0[3].name='Hour';$0[4]={};$0[4].value='MINUTELY';$0[4].name='Minute';Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper._frequencies=$0;}return Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper._frequencies;}
Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.serialise=function(scheduledJob){var $0=[];Xrm.ArrayEx.add($0,'FREQ='+scheduledJob.recurrance().value);Xrm.ArrayEx.add($0,'INTERVAL='+scheduledJob.recurEvery().toString());if(scheduledJob.recurrance().value==='WEEKLY'){var $2=[];if(scheduledJob.monday()){$2.add('MO');}if(scheduledJob.tuesday()){$2.add('TU');}if(scheduledJob.wednesday()){$2.add('WE');}if(scheduledJob.thursday()){$2.add('TH');}if(scheduledJob.friday()){$2.add('FR');}if(scheduledJob.saturday()){$2.add('SA');}if(scheduledJob.sunday()){$2.add('SU');}if($2.length>0){Xrm.ArrayEx.add($0,'BYDAY='+$2.join(','));}}if(!scheduledJob.noEndDate()){Xrm.ArrayEx.add($0,'COUNT='+scheduledJob.count());}var $1=$0.join(';');return $1;}
Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.deSerialise=function(scheduledJob,patternString){var $0=patternString.split(';');var $1=false,$2=false,$3=false,$4=false,$5=false,$6=false,$7=false;var $8=1;var $9=null;var $A=null;var $enum1=ss.IEnumerator.getEnumerator($0);while($enum1.moveNext()){var $B=$enum1.current;var $C=$B.split('=');switch($C[0]){case 'FREQ':for(var $E=0;$E<Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.get_recurranceFrequencies().length;$E++){if($C[1]===Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.get_recurranceFrequencies()[$E].value){$A=Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.get_recurranceFrequencies()[$E];break;}}break;case 'COUNT':$9=parseInt($C[1]);break;case 'INTERVAL':$8=parseInt($C[1]);break;case 'BYDAY':var $D=$C[1].split(',');var $enum2=ss.IEnumerator.getEnumerator($D);while($enum2.moveNext()){var $F=$enum2.current;switch($F){case 'MO':$1=true;break;case 'TU':$2=true;break;case 'WE':$3=true;break;case 'TH':$4=true;break;case 'FR':$5=true;break;case 'SA':$6=true;break;case 'SU':$7=true;break;}}break;}}scheduledJob.recurrance($A);scheduledJob.monday($1);scheduledJob.tuesday($2);scheduledJob.wednesday($3);scheduledJob.thursday($4);scheduledJob.friday($5);scheduledJob.saturday($6);scheduledJob.sunday($7);scheduledJob.recurEvery($8);scheduledJob.count($9);scheduledJob.noEndDate($9==null);}
Type.registerNamespace('Client.ScheduledJobsEditor.Views');Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView=function(){Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.initializeBase(this);}
Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.init=function(){$(function(){
ko.validation.registerExtenders();Xrm.Sdk.OrganizationServiceProxy.getUserSettings();var $1_0=new Client.ScheduledJobsEditor.ViewModels.ScheduledJobsEditorViewModel();Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.setUpGrids($1_0);SparkleXrm.ViewBase.registerViewModel($1_0);});}
Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.setUpGrids=function(vm){var $0=new SparkleXrm.GridEditor.GridDataViewBinder();var $1=SparkleXrm.GridEditor.GridDataViewBinder.parseLayout('dev1_name,Name,300,dev1_recurrancepattern,Pattern,300,createdon,Created On, 300');Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.jobsGrid=$0.dataBindXrmGrid(vm.jobsViewModel,$1,'jobsGrid','jobsGridPager',false,false);var $2=new SparkleXrm.GridEditor.GridDataViewBinder();var $3=SparkleXrm.GridEditor.GridDataViewBinder.parseLayout('name,Name,300,asyncoperation_statuscode,Status,100,asyncoperation_postponeuntil,Next Run,150,asyncoperation_recurrencepattern,Pattern,150,createdon,Created On,150');Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.bulkDeleteJobsGrid=$2.dataBindXrmGrid(vm.bulkDeleteJobsViewModel,$3,'bulkDeleteJobGrid','bulkDeleteJobGridPager',false,false);vm.jobsViewModel.refresh();}
Type.registerNamespace('Client.ContactEditor.Model');Client.ContactEditor.Model.Contact=function(){Client.ContactEditor.Model.Contact.initializeBase(this,['contact']);this._metaData['numberofchildren']=Xrm.Sdk.AttributeTypes.int_;this._metaData['creditlimit']=Xrm.Sdk.AttributeTypes.money;}
Client.ContactEditor.Model.Contact.prototype={contactid:null,fullname:null,firstname:null,lastname:null,birthdate:null,accountrolecode:null,numberofchildren:null,transactioncurrencyid:null,creditlimit:null,entityimage_url:null,ownerid:null,parentcustomerid:null}
Type.registerNamespace('Client.Views');Client.Views.ContactEditorView=function(){Client.Views.ContactEditorView.initializeBase(this);}
Client.Views.ContactEditorView.init=function(){var $0=new Client.ContactEditor.ViewModels.ContactsEditorViewModel();Xrm.Sdk.OrganizationServiceProxy.getUserSettings();var $1=SparkleXrm.GridEditor.GridDataViewBinder.parseLayout(',entityState,20,First Name,firstname,200,Last Name,lastname,200,Birth Date,birthdate,200,Account Role Code,accountrolecode,200,Number of Children,numberofchildren,100,Currency,transactioncurrencyid,200,Credit Limit,creditlimit,100,Gender,gendercode,100,Owner,ownerid,100,Parent Customer,parentcustomerid,100');$1[0].formatter=function($p1_0,$p1_1,$p1_2,$p1_3,$p1_4){
var $1_0=$p1_2;return (($1_0===Xrm.Sdk.EntityStates.changed)||($1_0===Xrm.Sdk.EntityStates.created))?"<span class='grid-edit-indicator'></span>":'';};SparkleXrm.GridEditor.XrmTextEditor.bindColumn($1[1]);SparkleXrm.GridEditor.XrmTextEditor.bindColumn($1[2]);var $2={};$2.hour=9;$2.minute=0;SparkleXrm.GridEditor.XrmDateEditor.bindColumn($1[3],false).options=$2;SparkleXrm.GridEditor.XrmOptionSetEditor.bindColumn($1[4],'contact',$1[4].field,true);SparkleXrm.GridEditor.XrmNumberEditor.bindColumn($1[5],0,100,0);SparkleXrm.GridEditor.XrmLookupEditor.bindColumn($1[6],ss.Delegate.create($0,$0.transactionCurrencySearchCommand),'transactioncurrencyid','currencyname','');SparkleXrm.GridEditor.XrmMoneyEditor.bindColumn($1[7],-10000,10000);SparkleXrm.GridEditor.XrmOptionSetEditor.bindColumn($1[8],'contact',$1[8].field,true);var $3=SparkleXrm.GridEditor.XrmLookupEditor.bindColumn($1[9],ss.Delegate.create($0,$0.ownerSearchCommand),'id','name','').options;$3.showFooter=true;var $4=SparkleXrm.GridEditor.XrmLookupEditor.bindColumn($1[10],ss.Delegate.create($0,$0.AccountSearchCommand),'id','name','').options;$4.showFooter=true;$4.footerButton=new SparkleXrm.GridEditor.XrmLookupEditorButton();$4.footerButton.label='Add New';$4.footerButton.image='/_imgs/add_10.png';$4.footerButton.onClick=ss.Delegate.create($0,$0.AddNewAccountInLine);var $5=new SparkleXrm.GridEditor.GridDataViewBinder();var $6=$5.dataBindXrmGrid($0.contacts,$1,'container','pager',true,false);SparkleXrm.ViewBase.registerViewModel($0);window.setTimeout(function(){
$0.init();},0);}
Type.registerNamespace('Client.TimeSheet.Model');Client.TimeSheet.Model.Queries=function(){}
Type.registerNamespace('TimeSheet.Client.ViewModel');TimeSheet.Client.ViewModel.ObservableActivityPointer=function(){this.id=ko.observable();this.subject=ko.observable();}
TimeSheet.Client.ViewModel.SessionVM=function(vm,data){this.dev1_sessionid=ko.observable();this.activity=ko.observable();this.dev1_starttime=ko.observable();this.dev1_endtime=ko.observable();this.dev1_description=ko.observable();this.dev1_duration=ko.observable();this.startTimeTime=ko.observable();this.endTimeTime=ko.observable();this.timeSoFar=ko.observable();this.test=ko.observable('test');if(data!=null){this.dev1_sessionid(data.dev1_sessionid);this.dev1_description(data.dev1_description);this.dev1_duration(data.dev1_duration);this.dev1_endtime(data.dev1_endtime);this.dev1_starttime(data.dev1_starttime);this.$1(this.dev1_starttime,this.startTimeTime);this.$1(this.dev1_endtime,this.endTimeTime);if(data.dev1_letterid!=null){this.activity(data.dev1_letterid);}else if(data.dev1_taskid!=null){this.activity(data.dev1_taskid);}}this.dev1_endtime.subscribe(ss.Delegate.create(this,function($p1_0){
this.onStartEndDateChanged();}));this.dev1_starttime.subscribe(ss.Delegate.create(this,function($p1_0){
this.onStartEndDateChanged();}));this.startTimeTime.subscribe(ss.Delegate.create(this,function($p1_0){
this.onStartEndDateChanged();}));this.endTimeTime.subscribe(ss.Delegate.create(this,function($p1_0){
this.onStartEndDateChanged();}));this.dev1_duration.subscribe(ss.Delegate.create(this,function($p1_0){
this.onDurationChanged();}));this.addValidation();}
TimeSheet.Client.ViewModel.SessionVM.calculateDuration=function(startTime,endTime){var $0=null;if((startTime!=null)&&(endTime!=null)){if((startTime!=null)&&(endTime!=null)){$0=(endTime.getTime()-startTime.getTime())/(1000*60);}}return $0;}
TimeSheet.Client.ViewModel.SessionVM.prototype={$0:false,onStartEndDateChanged:function(){if(this.$0){return;}this.$0=true;var $0=this.dev1_starttime();var $1=this.dev1_endtime();var $2=null;$0=Xrm.Sdk.DateTimeEx.addTimeToDate($0,this.startTimeTime());$1=Xrm.Sdk.DateTimeEx.addTimeToDate($1,this.endTimeTime());if($1!=null&&$0!=null){$1.setDate($0.getDate());$1.setMonth($0.getMonth());$1.setFullYear($0.getFullYear());}$2=TimeSheet.Client.ViewModel.SessionVM.calculateDuration($0,$1);this.dev1_duration($2);this.$0=false;},onDurationChanged:function(){if(this.$0){return;}this.$0=true;var $0=this.dev1_starttime();var $1=this.startTimeTime();if(($0!=null)&&($1!=null)){$0=Xrm.Sdk.DateTimeEx.addTimeToDate($0,$1);var $2=this.dev1_duration();var $3=$0.getTime();$3=$3+($2*1000*60);var $4=new Date($3);this.dev1_endtime($4);this.$1(this.dev1_endtime,this.endTimeTime);}this.$0=false;},getUpdatedModel:function(){var $0=new dev1_session();this.$2(this.dev1_starttime,this.startTimeTime);this.$2(this.dev1_endtime,this.endTimeTime);var $1={};$1.ignore=['dev1_letterid','dev1_taskid','dev1_emailid'];if(this.dev1_sessionid()!=null){$0.dev1_sessionid=this.dev1_sessionid();}$0.dev1_description=this.dev1_description();$0.dev1_starttime=this.dev1_starttime();$0.dev1_endtime=this.dev1_endtime();$0.dev1_duration=this.dev1_duration();return $0;},$1:function($p0,$p1){var $0=$p0();if($0!=null){var $1=$0.format('h:mm tt');$p1($1);}},$2:function($p0,$p1){var $0=$p0();$0=Xrm.Sdk.DateTimeEx.addTimeToDate($0,$p1());$p0($0);},addValidation:function(){var $0=this;SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the activity you wish to stop').register(this.activity);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the start date of the session').addRule('Start date must be before the end date',function($p1_0){
var $1_0=true;var $1_1=$0.dev1_endtime();if(($1_1!=null)&&($p1_0!=null)){$1_0=$1_1>$p1_0;}return $1_0;}).register(this.dev1_starttime);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the end time of the session').register(this.dev1_endtime);SparkleXrm.ValidationRules.createRules().addRequiredMsg('Enter the duration of the session').register(this.dev1_duration);}}
TimeSheet.Client.ViewModel.StartStopSessionViewModel=function(activityToStartStop,sessionToStartStop){this.openActvities=ko.observableArray();this.startNewSession=ko.observable(false);TimeSheet.Client.ViewModel.StartStopSessionViewModel.initializeBase(this);var $0=new dev1_session();$0.dev1_starttime=Date.get_now();this.startSession=ko.validatedObservable(new TimeSheet.Client.ViewModel.SessionVM(this,$0));var $1=Xrm.Sdk.OrganizationServiceProxy.retrieve('dev1_session','{FD722AC2-B234-E211-A471-000C299FFE7D}',['AllColumns']);var $2=new TimeSheet.Client.ViewModel.SessionVM(this,$1);this.stopSession=ko.validatedObservable($2);var $3={};$3.owner=this;$3.read=function(){
var $1_0=$3.owner;if($1_0.startNewSession()){return SparkleXrm.ValidationRules.areValid([($3.owner).stopSession,($3.owner).startSession]);}else{return SparkleXrm.ValidationRules.areValid([($3.owner).stopSession]);}};this.canSave=ko.dependentObservable($3);}
TimeSheet.Client.ViewModel.StartStopSessionViewModel.prototype={stopSession:null,startSession:null,canSave:null,isFormValid:function(){return true;},activitySearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='activitypointer'>\r\n                                <attribute name='activitytypecode' />\r\n                                <attribute name='subject' />\r\n                                <attribute name='activityid' />\r\n                                <attribute name='instancetypecode' />\r\n                                <order attribute='modifiedon' descending='false' />\r\n                                <filter type='and'>\r\n                                  <condition attribute='ownerid' operator='eq-userid' />\r\n                                    <condition attribute='subject' operator='like' value='%{0}%' />\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},$1_0:null,saveCommand:function(){if(this.$1_0==null){this.$1_0=ss.Delegate.create(this,function(){
var $1_0=confirm(String.format('Are you sure save these sessions?'));if(!$1_0){return;}var $1_1=this.stopSession();var $1_2=$1_1.getUpdatedModel();try{Xrm.Sdk.OrganizationServiceProxy.update($1_2);if(this.startNewSession()){var $1_3=this.startSession().getUpdatedModel();Xrm.Sdk.OrganizationServiceProxy.create($1_3);}}catch($1_4){alert('There was a problem saving your session. Please contact your system administrator.\n\n'+$1_4.message);}});}return this.$1_0;},$1_1:null,cancelCommand:function(){if(this.$1_1==null){this.$1_1=function(){
window.top.close();};}return this.$1_1;}}
Type.registerNamespace('Client.TimeSheet.ViewModel');Client.TimeSheet.ViewModel.DayEntry=function(){this.hours=new Array(6);Client.TimeSheet.ViewModel.DayEntry.initializeBase(this,['dayentry']);}
Client.TimeSheet.ViewModel.DayEntry.prototype={date:null,activity:null,account:null,regardingObjectId:null,activityName:null,isTotalRow:false,icon:null,day0:null,day1:null,day2:null,day3:null,day4:null,day5:null,day6:null,flatternDays:function(){this.day0=this.hours[0];this.day1=this.hours[1];this.day2=this.hours[2];this.day3=this.hours[3];this.day4=this.hours[4];this.day5=this.hours[5];this.day6=this.hours[6];}}
Client.TimeSheet.ViewModel.DaysViewModel=function(sessions){this.$1_5=[];Client.TimeSheet.ViewModel.DaysViewModel.initializeBase(this);this.$1_0=sessions;var $0=false;this.$1_0.onRowsChanged.subscribe(ss.Delegate.create(this,function($p1_0,$p1_1){
this.reCalculate();}));this.add_onSelectedRowsChanged(ss.Delegate.create(this,function(){
this.$1_1=null;}));this.onRowsChanged.subscribe(ss.Delegate.create(this,function($p1_0,$p1_1){
if($0){return;}$0=true;if(this.$1_1!=null&&this.$1_1.activity!=null){var $1_0=this.$1_1;this.$1_1=null;this.$1_6($1_0);}$0=false;}));sessions.onRowsChanged.subscribe(ss.Delegate.create(this,function($p1_0,$p1_1){
this.refresh();}));}
Client.TimeSheet.ViewModel.DaysViewModel.prototype={$1_0:null,$1_1:null,$1_2:null,$1_3:null,$1_4:null,_selectedDay:null,setCurrentWeek:function(date){this.$1_1=null;this.$1_0.setCurrentWeek(date);},get_selectedDay:function(){return this._selectedDay;},set_selectedDay:function(value){this._selectedDay=null;var $0=this.get_selectedItems();if($0!=null&&$0.length>0){if($0[0]!=null){this.$1_0.setCurrentActivity($0[0].activity,value);this._selectedDay=value;}}return value;},get_selectedItems:function(){if(this._selectedRows==null){return new Array(0);}var $0=new Array(this._selectedRows.length);var $1=0;var $enum1=ss.IEnumerator.getEnumerator(this._selectedRows);while($enum1.moveNext()){var $2=$enum1.current;$0[$1]=this.getItem($2.fromRow);$1++;}return $0;},getPagingInfo:function(){return null;},raiseOnDateChanged:function(){this.onRowsChanged.notify(null,null,this);},getLength:function(){return this.$1_5.length;},getItem:function(index){return this.$1_5[index];},setPagingOptions:function(p){},refresh:function(){if(this.$1_5!=null){var $0={};$0.from=0;$0.to=this.$1_5.length-1;this.onDataLoaded.notify($0,null,null);this.onRowsChanged.notify($0,null,this);}},reCalculate:function(){if(this.$1_1!=null){return;}var $0=this.$1_0.getCurrentWeek();var $1=this.$1_0.weekStart;this.$1_3={};this.$1_2=new Client.TimeSheet.ViewModel.DayEntry();this.$1_2.isTotalRow=true;this.$1_2.activityName='Total';this.$1_2.activity=new Xrm.Sdk.EntityReference(null,null,null);this.$1_2.activity.name='Total';var $enum1=ss.IEnumerator.getEnumerator($0);while($enum1.moveNext()){var $2=$enum1.current;if($2.dev1_starttime==null){continue;}var $3=$2.dev1_starttime.getDay()-Xrm.Sdk.OrganizationServiceProxy.organizationSettings.weekstartdaycode.value;if($3<0){$3=7+$3;}var $4=$2.dev1_activityid;if(this.$1_3[$4]==null){var $5=new Client.TimeSheet.ViewModel.DayEntry();this.$1_3[$4]=$5;$5.activity=new Xrm.Sdk.EntityReference(new Xrm.Sdk.Guid($2.dev1_activityid),null,null);$5.activity.name=$2.activitypointer_subject;$5.regardingObjectId=$2.activitypointer_regardingobjectid;if($2.account!=null&&$5.account==null){$5.account=$2.account;}$5.activity.logicalName=$2.dev1_activitytypename;}if($2.dev1_duration!=null){if(this.$1_3[$4].hours[$3]==null){this.$1_3[$4].hours[$3]=0;}this.$1_3[$4].hours[$3]=this.$1_3[$4].hours[$3]+$2.dev1_duration;if(this.$1_2.hours[$3]==null){this.$1_2.hours[$3]=0;}this.$1_2.hours[$3]=this.$1_2.hours[$3]+$2.dev1_duration;}}this.$1_5.clear();this.$1_5.add(this.$1_2);var $dict2=this.$1_3;for(var $key3 in $dict2){var $6={key:$key3,value:$dict2[$key3]};$6.value.flatternDays();this.$1_5.add($6.value);}this.$1_2.flatternDays();this.$1_8();this.refresh();},addItem:function(item){var $0=item;if(($0.activity!=null)&&($0.activity.id!=null)){this.$1_6($0);}else{this.$1_1=$0;this.$1_5.add(this.$1_1);}this.refresh();},$1_6:function($p0){this.$1_0.setCurrentActivity($p0.activity,0);var $0=new dev1_session();$0.account=$p0.account;$0.dev1_activityid=$p0.activity.id.toString();$0.dev1_activitytypename=$p0.activity.logicalName;$0.dev1_activityid=$p0.activity.id.toString();$0.dev1_starttime=this.$1_0.weekStart;$0.activitypointer_subject=$p0.activity.name;$0.activitypointer_regardingobjectid=$p0.regardingObjectId;this.$1_0.selectedActivity=$p0.activity;$0.dev1_row=this.$1_0.getCurrentWeek().length;if($0.account==null||$0.activitypointer_regardingobjectid==null){this.$1_7($0);}this.$1_0.addItem($0);this._selectedRows=[{}];this._selectedRows[0].fromRow=this.$1_5.length+1;this._selectedRows[0].toRow=this.$1_5.length+1;},$1_7:function($p0){var $0="\r\n                    <fetch>\r\n                        <entity name='activitypointer' >\r\n                                <attribute name='regardingobjectid' />\r\n                                <filter type='and'>\r\n                                    <condition attribute='activityid' operator='eq' value='{0}' />\r\n                                </filter>\r\n                                <link-entity name='contract' from='contractid' to='regardingobjectid' visible='false' link-type='outer' alias='contract' >\r\n                                    <attribute name='customerid' alias='contract_customerid'/>\r\n                                </link-entity>\r\n                                <link-entity name='opportunity' from='opportunityid' to='regardingobjectid' visible='false' link-type='outer' alias='opportunity' >\r\n                                    <attribute name='customerid' alias='opportunity_customerid'/>\r\n                                </link-entity>\r\n                                <link-entity name='incident' from='incidentid' to='regardingobjectid' visible='false' link-type='outer' alias='incident' >\r\n                                    <attribute name='customerid' alias='incident_customerid'/>\r\n                                </link-entity>                        \r\n                        </entity>\r\n                    </fetch>";var $1=Xrm.Sdk.OrganizationServiceProxy.retrieveMultiple(String.format($0,$p0.dev1_activityid));if($1.get_entities().get_count()>0){var $2=null;var $3=$1.get_entities().get_item(0);var $4=$3.getAttributeValueEntityReference('incident_customerid');var $5=$3.getAttributeValueEntityReference('opportunity_customerid');var $6=$3.getAttributeValueEntityReference('contract_customerid');var $7=$3.getAttributeValueEntityReference('regardingobjectid');if($4!=null){$2=$4;}else if($5!=null){$2=$5;}else if($6!=null){$2=$6;}else if($7!=null&&$7.logicalName==='account'){$2=$7;}$p0.account=$2;$p0.activitypointer_regardingobjectid=$3.getAttributeValueEntityReference('regardingobjectid');}},sort:function(sorting){this.$1_4=sorting;this.$1_8();this.refresh();},$1_8:function(){if(this.$1_4==null){return;}var $0=this.$1_5[0];this.$1_5.removeAt(0);if(!this.$1_4.sortAsc){this.$1_5.reverse();}this.$1_5.sort(ss.Delegate.create(this,function($p1_0,$p1_1){
return Xrm.Sdk.Entity.sortDelegate(this.$1_4.sortCol.field,$p1_0,$p1_1);}));if(!this.$1_4.sortAsc){this.$1_5.reverse();}this.$1_5.insert(0,$0);}}
Client.TimeSheet.ViewModel.SessionsViewModel=function(){this.$1_0={};this.$1_2=[];Client.TimeSheet.ViewModel.SessionsViewModel.initializeBase(this);}
Client.TimeSheet.ViewModel.SessionsViewModel.$1_6=function($p0){var $0=$p0;var $1=$0.dev1_starttime;if($1!=null){var $2=$0.dev1_duration;var $3=$1.getTime();$3=$3+($2*1000*60);var $4=new Date($3);$0.dev1_endtime=$4;}}
Client.TimeSheet.ViewModel.SessionsViewModel.$1_7=function($p0){var $0=$p0;if($0.dev1_starttime!=null&&$0.dev1_endtime!=null){$0.dev1_endtime.setDate($0.dev1_starttime.getUTCDate());$0.dev1_endtime.setMonth($0.dev1_starttime.getUTCMonth());$0.dev1_endtime.setFullYear($0.dev1_starttime.getUTCFullYear());}$0.dev1_duration=TimeSheet.Client.ViewModel.SessionVM.calculateDuration($0.dev1_starttime,$0.dev1_endtime);}
Client.TimeSheet.ViewModel.SessionsViewModel.prototype={$1_1:null,weekStart:null,weekEnd:null,selectedDay:null,selectedActivityID:null,selectedActivity:null,getCurrentWeek:function(){return this.$1_0[this.weekStart.getTime()];},setCurrentWeek:function(date){this.$1_1=date;this.weekStart=Xrm.Sdk.DateTimeEx.firstDayOfWeek(date);this.weekEnd=Xrm.Sdk.DateTimeEx.lastDayOfWeek(date);this.refresh();},$1_3:function(){if(this.selectedDay==null){return null;}var $0=(this.selectedDay-this.weekStart)/(24*60*60*1000);return $0+1;},setCurrentActivity:function(entityReference,day){var $0=((entityReference!=null&&entityReference.id!=null)?entityReference.id.value:null)!==((this.selectedActivity!=null&&this.selectedActivity.id!=null)?this.selectedActivity.id.value:null);$0=$0||(day!==this.$1_3());if(!$0){return;}if(day>0){this.selectedDay=Xrm.Sdk.DateTimeEx.dateAdd('days',day-1,this.weekStart);}else{this.selectedDay=null;}this.selectedActivity=entityReference;if(entityReference!=null&&entityReference.id!=null){this.selectedActivityID=entityReference.id;}else{this.selectedActivityID=null;}this.$1_8();},$1_4:function($p0,$p1){$p0.add($p1);if($p1.opportunity_customerid!=null){$p1.account=$p1.opportunity_customerid;}else if($p1.contract_customerid!=null){$p1.account=$p1.contract_customerid;}else if($p1.incident_customerid!=null){$p1.account=$p1.incident_customerid;}else if($p1.activitypointer_regardingobjectid!=null&&$p1.activitypointer_regardingobjectid.logicalName==='account'){$p1.account=$p1.activitypointer_regardingobjectid;}if($p1.dev1_endtime==null&&$p1.dev1_duration!=null){Client.TimeSheet.ViewModel.SessionsViewModel.$1_6($p1);}else if($p1.dev1_duration==null){Client.TimeSheet.ViewModel.SessionsViewModel.$1_7($p1);}if($p1.statuscode!=null&&$p1.statuscode.value!==1){$p1.entityState=Xrm.Sdk.EntityStates.readOnly;}$p1.add_propertyChanged(ss.Delegate.create(this,this.$1_5));},$1_5:function($p0,$p1){if(($p1.propertyName==='dev1_starttime')||($p1.propertyName==='dev1_endtime')){Client.TimeSheet.ViewModel.SessionsViewModel.$1_7($p0);}else if($p1.propertyName==='dev1_duration'){Client.TimeSheet.ViewModel.SessionsViewModel.$1_6($p0);}this.refresh();},onBeforeEdit:function(item){var $0=item;if(item!=null){return ($0.entityState!==Xrm.Sdk.EntityStates.readOnly);}else{return true;}},$1_8:function(){this.$1_2=[];var $enum1=ss.IEnumerator.getEnumerator(this.getCurrentWeek());while($enum1.moveNext()){var $1=$enum1.current;if(((this.selectedActivityID==null)||($1.dev1_activityid===this.selectedActivityID.toString()))&&((this.selectedDay==null)||($1.dev1_starttime.getDay()===this.selectedDay.getDay()))){this.$1_2.add($1);}}var $0={};$0.from=0;$0.to=this.$1_2.length-1;this.onDataLoaded.notify($0,null,null);this.onRowsChanged.notify(null,null,this);},getEditedSessions:function(){var $0=[];var $enum1=ss.IEnumerator.getEnumerator(this.$1_0[this.weekStart.getTime()]);while($enum1.moveNext()){var $1=$enum1.current;if($1.dev1_sessionid==null||$1.entityState===Xrm.Sdk.EntityStates.changed||$1.entityState===Xrm.Sdk.EntityStates.created){$0.add($1);}}return $0;},getPagingInfo:function(){return null;},getLength:function(){if(this.$1_2!=null){return this.$1_2.length;}else{return 0;}},removeItem:function(id){this.$1_0[this.weekStart.getTime()].remove(id);},getItem:function(index){return this.$1_2[index];},setPagingOptions:function(p){},refresh:function(){if(this.$1_0[this.weekStart.getTime()]==null){this.onDataLoading.notify(null,null,null);Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple(String.format(Client.TimeSheet.Model.Queries.sessionsByWeekStartDate,Xrm.Sdk.DateTimeEx.toXrmString(this.weekStart),Xrm.Sdk.DateTimeEx.toXrmString(this.weekEnd)),ss.Delegate.create(this,function($p1_0){
try{var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,dev1_session);var $1_1=[];this.$1_0[this.weekStart.getTime()]=$1_1;var $enum1=ss.IEnumerator.getEnumerator($1_0.get_entities());while($enum1.moveNext()){var $1_2=$enum1.current;this.$1_4($1_1,$1_2);}this.$1_8();}catch($1_3){alert('There was an error loading the Timesheet sessions\n'+$1_3.message);}}));}else{this.$1_8();}},addItem:function(item){if(this.selectedActivity!=null){var $0=this.getCurrentWeek();var $1=item;var $2=new dev1_session();$2.dev1_description=$1.dev1_description;$2.dev1_starttime=$1.dev1_starttime;$2.dev1_duration=$1.dev1_duration;$2.account=$1.account;$2.activitypointer_regardingobjectid=($1.activitypointer_regardingobjectid==null)?this.selectedActivity:$1.activitypointer_regardingobjectid;$2.activitypointer_subject=($1.activitypointer_regardingobjectid==null)?this.selectedActivity.name:$1.activitypointer_subject;$2.dev1_activityid=this.selectedActivity.id.toString();$2.dev1_activitytypename=this.selectedActivity.logicalName;switch(this.selectedActivity.logicalName){case 'phonecall':$2.dev1_phonecallid=this.selectedActivity;break;case 'task':$2.dev1_taskid=this.selectedActivity;break;case 'letter':$2.dev1_letterid=this.selectedActivity;break;case 'email':$2.dev1_emailid=this.selectedActivity;break;}$2.entityState=Xrm.Sdk.EntityStates.created;if($2.dev1_starttime==null){$2.dev1_starttime=(this.selectedDay==null)?this.weekStart:this.selectedDay;}this.$1_4($0,$2);this.$1_2.add($2);var $3={};$3.from=this.$1_2.length-1;$3.to=this.$1_2.length-1;this.onDataLoaded.notify($3,null,null);this.onRowsChanged.notify(null,null,null);}}}
Client.TimeSheet.ViewModel.TimeSheetViewModel=function(){this.startTimeTime=ko.observable();Client.TimeSheet.ViewModel.TimeSheetViewModel.initializeBase(this);this.sessionDataView=new Client.TimeSheet.ViewModel.SessionsViewModel();this.days=new Client.TimeSheet.ViewModel.DaysViewModel(this.sessionDataView);this.sessionDataView.setCurrentWeek(Date.get_today());this.startTimeTime(Date.parseDate('1975-01-16T13:00:00'));}
Client.TimeSheet.ViewModel.TimeSheetViewModel.prototype={sessionDataView:null,days:null,$1_0:function($p0){debugger;alert('There was a problem with your request. Please contact your system administrator.\n\n'+$p0.message);this.isBusy(false);},regardingObjectSearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                                  <entity name='account'>\r\n                                    <attribute name='name' />\r\n                                    <attribute name='accountid' />\r\n                                    <order attribute='name' descending='false' />\r\n                                    <filter type='and'>\r\n                                      <condition attribute='statecode' operator='eq' value='0' />\r\n                                      <condition attribute='name' operator='like' value='%{0}%' />\r\n                                      {1}\r\n                                    </filter>\r\n                                   </entity>\r\n                                </fetch>";var $1="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                                                  <entity name='opportunity'>\r\n                                                    <attribute name='name' />\r\n                                                    <attribute name='opportunityid' />\r\n                                                    <order attribute='name' descending='false' />\r\n                                                    <filter type='and'>\r\n                                                      <condition attribute='statecode' operator='eq' value='0' />\r\n                                                      <condition attribute='name' operator='like' value='%{0}%' />\r\n                                                     {1}\r\n                                                    </filter>\r\n                                                  </entity>\r\n                                                </fetch>";var $2="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                                              <entity name='incident'>\r\n                                                <attribute name='title' />\r\n                                                <attribute name='incidentid' />\r\n                                                <order attribute='title' descending='false' />\r\n                                                <filter type='and'>\r\n                                                  <condition attribute='title' operator='like' value='%{0}%' />\r\n                                                  {1}\r\n                                                </filter>\r\n                                              </entity>\r\n                                            </fetch>";var $3="<condition attribute='{0}' operator='eq' value='{1}' />";var $4=this.days.get_selectedItems()[0];var $5=[];var $6=function($p1_0,$p1_1,$p1_2,$p1_3,$p1_4){
var $1_0='';if($4!=null&&$4.account!=null){$1_0=String.format($3,$p1_2,$4.account.id.value);}var $1_1=String.format($p1_0,Xrm.Sdk.XmlHelper.encode(term),$1_0);Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($1_1,function($p2_0){
var $2_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p2_0,ActivityPointer);var $enum1=ss.IEnumerator.getEnumerator($2_0.get_entities());while($enum1.moveNext()){var $2_1=$enum1.current;$2_1.setAttributeValue('displayName',$2_1.getAttributeValueString($p1_1));$5.add($2_1);}$p1_3();});};var $7=new Xrm.TaskIterrator();$7.addTask(function($p1_0,$p1_1){
$6($0,'name','accountid',$p1_0,$p1_1);});$7.addTask(function($p1_0,$p1_1){
$6($1,'name','customerid',$p1_0,$p1_1);});$7.addTask(function($p1_0,$p1_1){
$6($2,'title','customerid',$p1_0,$p1_1);});var $8=function(){
$5.sort(function($p2_0,$p2_1){
return Xrm.Sdk.Entity.sortDelegate('displayName',$p2_0,$p2_1);});var $1_0=new Xrm.Sdk.EntityCollection($5);callback($1_0);};$7.start($8,null);},activitySearchCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                                  <entity name='activitypointer'>\r\n                                    <attribute name='activitytypecode' />\r\n                                    <attribute name='subject' />\r\n                                    <attribute name='activityid' />\r\n                                    <attribute name='instancetypecode' />\r\n                                    <attribute name='regardingobjectid' />\r\n                                    <order attribute='modifiedon' descending='false' />\r\n                                    <filter type='and'>\r\n                                      <condition attribute='ownerid' operator='eq-userid' />\r\n                                        <condition attribute='subject' operator='like' value='%{0}%' />\r\n                                          <condition attribute='activitytypecode' operator='in'>\r\n                                            <value>4202</value>\r\n                                            <value>4207</value>\r\n                                            <value>4210</value>\r\n                                            <value>4212</value>\r\n                                          </condition>\r\n                                            {2}\r\n                                    </filter>\r\n                                    {1}\r\n                                  </entity>\r\n                                </fetch>";var $1="<condition attribute='regardingobjectid' operator='eq' value='{0}'/>";var $2="<link-entity name='opportunity' from='opportunityid' to='regardingobjectid' visible='false' link-type='inner' alias='opportunity' >\r\n                                        <attribute name='customerid' />\r\n                                        <filter type='and' >\r\n                                            <condition attribute='customerid' operator='eq' value='{0}' />\r\n                                        </filter>\r\n                                        </link-entity>";var $3=" <link-entity name='incident' from='incidentid' to='regardingobjectid' visible='false' link-type='inner' alias='incident' >\r\n                                        <attribute name='customerid' />\r\n                                        <filter type='and' >\r\n                                            <condition attribute='customerid' operator='eq' value='{0}' />\r\n                                        </filter>\r\n                                        </link-entity>";var $4=" <link-entity name='contract' from='contractid' to='regardingobjectid' visible='false' link-type='inner' alias='contract' >\r\n                                        <attribute name='customerid' />\r\n                                        <filter type='and' >\r\n                                            <condition attribute='customerid' operator='eq' value='{0}' />\r\n                                        </filter>\r\n                                        </link-entity>";var $5=" <link-entity name='account' from='accountid' to='regardingobjectid' visible='false' link-type='inner' alias='account' >\r\n                                        <attribute name='accountid'/>\r\n                                        <attribute name='name'/>\r\n                                        <filter type='and' >\r\n                                            <condition attribute='accountid' operator='eq' value='{0}' />\r\n                                        </filter>\r\n                                        </link-entity>";var $6=this.days.get_selectedItems()[0];var $7='';var $8='';var $9='';var $A='';var $B='';if($6!=null&&$6.regardingObjectId!=null){$7=String.format($1,$6.regardingObjectId.id.value);}if($6!=null&&$6.account!=null){$8=String.format($5,$6.account.id.value);$9=String.format($2,$6.account.id.value);$A=String.format($3,$6.account.id.value);$B=String.format($4,$6.account.id.value);}var $C=[];var $D=function($p1_0,$p1_1,$p1_2,$p1_3){
var $1_0=String.format($0,Xrm.Sdk.XmlHelper.encode(term),$p1_0,$p1_1);Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($1_0,function($p2_0){
var $2_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p2_0,ActivityPointer);var $enum1=ss.IEnumerator.getEnumerator($2_0.get_entities());while($enum1.moveNext()){var $2_1=$enum1.current;$2_1.$1_0();$C.add($2_1);}$p1_2();});};var $E=new Xrm.TaskIterrator();$E.addTask(function($p1_0,$p1_1){
$D($8,$7,$p1_0,$p1_1);});if(!!$9){$E.addTask(function($p1_0,$p1_1){
$D($9,'',$p1_0,$p1_1);});}if(!!$A){$E.addTask(function($p1_0,$p1_1){
$D($A,'',$p1_0,$p1_1);});}if(!!$B){$E.addTask(function($p1_0,$p1_1){
$D($B,'',$p1_0,$p1_1);});}var $F=function(){
$C.sort(function($p2_0,$p2_1){
return Xrm.Sdk.Entity.sortDelegate('subject',$p2_0,$p2_1);});var $1_0=new Xrm.Sdk.EntityCollection($C);callback($1_0);};$E.start($F,null);},accountSeachCommand:function(term,callback){var $0="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>\r\n                              <entity name='account'>\r\n                                <attribute name='name' />\r\n                                <attribute name='accountid' />\r\n                                <order attribute='name' descending='false' />\r\n                                <filter type='and'>\r\n                                  <filter type='or'>\r\n                                    <condition attribute='name' operator='like' value='%{0}%' />\r\n                                    <condition attribute='accountnumber' operator='like' value='%{0}%' />\r\n                                  </filter>\r\n                                  <condition attribute='statecode' operator='eq' value='0' />\r\n                                </filter>\r\n                              </entity>\r\n                            </fetch>";$0=String.format($0,Xrm.Sdk.XmlHelper.encode(term));Xrm.Sdk.OrganizationServiceProxy.beginRetrieveMultiple($0,function($p1_0){
var $1_0=Xrm.Sdk.OrganizationServiceProxy.endRetrieveMultiple($p1_0,Xrm.Sdk.Entity);callback($1_0);});},$1_1:null,saveCommand:function(){if(this.$1_1==null){this.$1_1=ss.Delegate.create(this,function(){
var $1_0=confirm(String.format('Are you sure save these sessions?'));if(!$1_0){return;}try{this.isBusy(true);this.isBusyProgress(0);this.isBusyMessage('Saving...');var $1_1=this.sessionDataView.getEditedSessions();Xrm.DelegateItterator.callbackItterate(ss.Delegate.create(this,function($p2_0,$p2_1,$p2_2){
var $2_0=$1_1[$p2_0];var $2_1=new dev1_session();$2_1.dev1_sessionid=$2_0.dev1_sessionid;$2_1.dev1_activityid=$2_0.dev1_activityid;$2_1.dev1_activitytypename=$2_0.dev1_activitytypename;$2_1.dev1_description=$2_0.dev1_description;$2_1.dev1_duration=$2_0.dev1_duration;$2_1.dev1_emailid=$2_0.dev1_emailid;$2_1.dev1_endtime=$2_0.dev1_endtime;$2_1.dev1_letterid=$2_0.dev1_letterid;$2_1.dev1_phonecallid=$2_0.dev1_phonecallid;$2_1.dev1_sessionid=$2_0.dev1_sessionid;$2_1.dev1_starttime=$2_0.dev1_starttime;$2_1.dev1_taskid=$2_0.dev1_taskid;$2_1.dev1_row=$2_0.dev1_row;this.isBusyProgress(($p2_0/$1_1.length)*100);if($2_0.dev1_sessionid==null){if($2_1.dev1_duration!=null&&$2_1.dev1_duration>0){Xrm.Sdk.OrganizationServiceProxy.beginCreate($2_1,ss.Delegate.create(this,function($p3_0){
this.isBusyProgress(($p2_0/$1_1.length)*100);try{$2_0.dev1_sessionid=Xrm.Sdk.OrganizationServiceProxy.endCreate($p3_0);$2_0.entityState=Xrm.Sdk.EntityStates.unchanged;$2_0.raisePropertyChanged('EntityState');$p2_1();}catch($3_0){alert($3_0.message);$p2_1();}}));}else{$p2_1();}}else{Xrm.Sdk.OrganizationServiceProxy.beginUpdate($2_1,function($p3_0){
try{Xrm.Sdk.OrganizationServiceProxy.endUpdate($p3_0);$2_0.entityState=Xrm.Sdk.EntityStates.unchanged;$2_0.raisePropertyChanged('EntityState');$p2_1();}catch($3_0){alert($3_0.message);$p2_1();}});}}),$1_1.length,ss.Delegate.create(this,function(){
this.isBusyProgress(100);this.isBusy(false);}),ss.Delegate.create(this,function($p2_0){
this.$1_0($p2_0);}));}catch($1_2){this.$1_0($1_2);}});}return this.$1_1;},$1_2:null,deleteCommand:function(){if(this.$1_2==null){this.$1_2=ss.Delegate.create(this,function(){
var $1_0=SparkleXrm.GridEditor.DataViewBase.rangesToRows(this.sessionDataView.getSelectedRows());if(!$1_0.length){return;}var $1_1=confirm(String.format('Are you sure you want to delete the {0} selected sessions?',$1_0.length));if(!$1_1){return;}this.isBusyMessage('Deleting Sessions...');this.isBusyProgress(0);this.isBusy(true);var $1_2=[];for(var $1_3=0;$1_3<$1_0.length;$1_3++){$1_2.add(this.sessionDataView.getItem($1_3));}Xrm.DelegateItterator.callbackItterate(ss.Delegate.create(this,function($p2_0,$p2_1,$p2_2){
var $2_0=$1_2[$p2_0];this.isBusyProgress(($p2_0/$1_0.length)*100);if($2_0.dev1_sessionid!=null){Xrm.Sdk.OrganizationServiceProxy.beginDelete($2_0.logicalName,$2_0.dev1_sessionid,ss.Delegate.create(this,function($p3_0){
try{Xrm.Sdk.OrganizationServiceProxy.endDelete($p3_0);this.sessionDataView.removeItem($2_0);this.sessionDataView.refresh();$p2_1();}catch($3_0){alert($3_0.message);$p2_1();}}));}else{this.sessionDataView.removeItem($2_0);this.sessionDataView.refresh();$p2_1();}}),$1_0.length,ss.Delegate.create(this,function(){
this.isBusyProgress(100);this.isBusy(false);this.sessionDataView.refresh();this.days.reCalculate();}),ss.Delegate.create(this,function($p2_0){
this.$1_0($p2_0);}));});}return this.$1_2;},$1_3:null,resetCommand:function(){if(this.$1_3==null){}return this.$1_3;}}
Type.registerNamespace('Client.TimeSheet.View');Client.TimeSheet.View.StartStopSession=function(){Client.TimeSheet.View.StartStopSession.initializeBase(this);}
Client.TimeSheet.View.StartStopSession.init=function(){var $0=new TimeSheet.Client.ViewModel.StartStopSessionViewModel(null,null);SparkleXrm.ViewBase.registerViewModel($0);}
Client.TimeSheet.View.TimeSheetView=function(){Client.TimeSheet.View.TimeSheetView.initializeBase(this);}
Client.TimeSheet.View.TimeSheetView.init=function(){Xrm.PageEx.majorVersion=2013;$(function(){
ko.validation.registerExtenders();Xrm.Sdk.OrganizationServiceProxy.getUserSettings();var $1_0=new Client.TimeSheet.ViewModel.TimeSheetViewModel();Client.TimeSheet.View.TimeSheetView.setUpGrids($1_0);Client.TimeSheet.View.TimeSheetView.$1_3($1_0);$('#timesheetGridContainer').resizable();SparkleXrm.ViewBase.registerViewModel($1_0);});}
Client.TimeSheet.View.TimeSheetView.$1_3=function($p0){var $0=$('#datepicker');var $1='dd/MM/yy';if(Xrm.Sdk.OrganizationServiceProxy.userSettings!=null){$1=Xrm.Sdk.OrganizationServiceProxy.userSettings.dateformatstring;}var $2={};$2.numberOfMonths=3;$2.firstDay=Xrm.Sdk.OrganizationServiceProxy.organizationSettings.weekstartdaycode.value;$2.dateFormat=$1.replaceAll('MM','mm').replaceAll('yyyy','yy').replaceAll('M','m');$2.onSelect=function($p1_0,$p1_1){
var $1_0=Client.TimeSheet.View.TimeSheetView.$1_1.getEditController();var $1_1=$1_0.commitCurrentEdit();if($1_1){var $1_2=$0.datepicker('getDate');$p0.days.setCurrentWeek($1_2);}};$0.datepicker($2);}
Client.TimeSheet.View.TimeSheetView.setUpGrids=function(vm){var $0=vm.days;var $1=[];SparkleXrm.GridEditor.GridDataViewBinder.bindRowIcon(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'',50,'icon'),'activity');SparkleXrm.GridEditor.XrmLookupEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Account',300,'account'),ss.Delegate.create(vm,vm.accountSeachCommand),'accountid','name',null);SparkleXrm.GridEditor.XrmLookupEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Regarding',300,'regardingObjectId'),ss.Delegate.create(vm,vm.regardingObjectSearchCommand),'id','displayName',null);SparkleXrm.GridEditor.XrmLookupEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,'Activity',300,'activity'),ss.Delegate.create(vm,vm.activitySearchCommand),'activityid','subject','activitytypecode');var $2=['Sun','Mon','Tue','Wed','Thu','Fri','Sat','Sun','Mon','Tue','Wed','Thu','Fri','Sat'];var $3=Xrm.Sdk.OrganizationServiceProxy.organizationSettings.weekstartdaycode.value;SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3],50,'day0');SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3+1],50,'day1');SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3+2],50,'day2');SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3+3],50,'day3');SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3+4],50,'day4');SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3+5],50,'day5');SparkleXrm.GridEditor.GridDataViewBinder.addColumn($1,$2[$3+6],50,'day6');var $4=new SparkleXrm.GridEditor.GridDataViewBinder();$4.selectActiveRow=true;$4.addCheckBoxSelectColumn=false;Client.TimeSheet.View.TimeSheetView.$1_0=$4.dataBindXrmGrid($0,$1,'timesheetGridContainer',null,true,true);$0.add_onGetItemMetaData(function($p1_0){
var $1_0={};var $1_1=$p1_0;if($1_1!=null&&$1_1.isTotalRow){$1_0.editor=function($p2_0){
return null;};$1_0.columns={};$1_0.columns['Account']={editor:null};$1_0.columns['Regarding']={editor:null};$1_0.columns['Activity']={editor:null};$1_0.formatter=function($p2_0,$p2_1,$p2_2,$p2_3,$p2_4){
switch($p2_3.field){case 'account':case 'regardingObjectId':return '';case 'activity':return 'Total';default:return SparkleXrm.GridEditor.XrmDurationEditor.formatter($p2_0,$p2_1,$p2_2,$p2_3,$p2_4);}};$1_0.cssClasses='days_total_row';}else{$1_0.formatter=function($p2_0,$p2_1,$p2_2,$p2_3,$p2_4){
switch($p2_3.field){case 'account':case 'regardingObjectId':case 'activity':return SparkleXrm.GridEditor.XrmLookupEditor.formatter($p2_0,$p2_1,$p2_2,$p2_3,$p2_4);default:return SparkleXrm.GridEditor.XrmDurationEditor.formatter($p2_0,$p2_1,$p2_2,$p2_3,$p2_4);}};}return $1_0;});$4.dataBindSelectionModel(Client.TimeSheet.View.TimeSheetView.$1_0,$0);var $5=vm.sessionDataView;var $6=[];SparkleXrm.GridEditor.GridDataViewBinder.addEditIndicatorColumn($6);SparkleXrm.GridEditor.XrmTextEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($6,'Activity',300,'activitypointer_subject')).editor=null;SparkleXrm.GridEditor.XrmDateEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($6,'Date',100,'dev1_starttime'),true);SparkleXrm.GridEditor.XrmTimeEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($6,'Start',100,'dev1_starttime')).validator=function($p1_0,$p1_1){
var $1_0=$p1_1;var $1_1=$p1_0;var $1_2={};if($1_0.dev1_endtime!=null){$1_2.valid=true;var $1_3=$p1_0;var $1_4=Xrm.Sdk.DateTimeEx.getTimeDuration($1_1)<Xrm.Sdk.DateTimeEx.getTimeDuration($1_0.dev1_endtime);$1_2.valid=$1_4;$1_2.message='The start time must be before the end time';}else{$1_2.valid=true;}return $1_2;};SparkleXrm.GridEditor.XrmTimeEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($6,'End',100,'dev1_endtime')).validator=function($p1_0,$p1_1){
var $1_0=$p1_1;var $1_1=$p1_0;var $1_2={};if($1_0.dev1_starttime!=null){$1_2.valid=true;var $1_3=$p1_0;var $1_4=Xrm.Sdk.DateTimeEx.getTimeDuration($1_0.dev1_starttime)<Xrm.Sdk.DateTimeEx.getTimeDuration($1_1);$1_2.valid=$1_4;$1_2.message='The end time must be after the start time';}else{$1_2.valid=true;}return $1_2;};SparkleXrm.GridEditor.XrmDurationEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($6,'Duration',70,'dev1_duration'));SparkleXrm.GridEditor.XrmTextEditor.bindColumn(SparkleXrm.GridEditor.GridDataViewBinder.addColumn($6,'Description',300,'dev1_description'));var $7=new SparkleXrm.GridEditor.GridDataViewBinder();$7.selectActiveRow=false;$7.addCheckBoxSelectColumn=true;Client.TimeSheet.View.TimeSheetView.$1_1=$7.dataBindXrmGrid($5,$6,'sessionsGridContainer',null,true,true);Client.TimeSheet.View.TimeSheetView.$1_1.onBeforeEditCell.subscribe(function($p1_0,$p1_1){
var $1_0=($p1_1).item;var $1_1=$5.onBeforeEdit($1_0);return $1_1;});Client.TimeSheet.View.TimeSheetView.$1_0.onActiveCellChanged.subscribe(function($p1_0,$p1_1){
var $1_0=Client.TimeSheet.View.TimeSheetView.$1_0.getActiveCell();if($1_0!=null){if($1_0.cell<Client.TimeSheet.View.TimeSheetView.$1_2){vm.days.set_selectedDay(null);}else{vm.days.set_selectedDay($1_0.cell-(Client.TimeSheet.View.TimeSheetView.$1_2-1));}}});}
ActivityPointer.registerClass('ActivityPointer',Xrm.Sdk.Entity);dev1_session.registerClass('dev1_session',Xrm.Sdk.Entity);AddressSearch.App.registerClass('AddressSearch.App');Client.ContactEditor.ViewModels.AssignRequest.registerClass('Client.ContactEditor.ViewModels.AssignRequest',null,Object);Client.ContactEditor.ViewModels.AssignResponse.registerClass('Client.ContactEditor.ViewModels.AssignResponse',null,Object);Client.ContactEditor.ViewModels.ContactValidation.registerClass('Client.ContactEditor.ViewModels.ContactValidation');Client.ContactEditor.ViewModels.ObservableContact.registerClass('Client.ContactEditor.ViewModels.ObservableContact');Client.ContactEditor.ViewModels.ContactsEditorViewModel.registerClass('Client.ContactEditor.ViewModels.ContactsEditorViewModel',SparkleXrm.ViewModelBase);Client.DataGrouping.ViewModels.DataGroupingViewModel.registerClass('Client.DataGrouping.ViewModels.DataGroupingViewModel',SparkleXrm.ViewModelBase);Client.DataGrouping.ViewModels.Project.registerClass('Client.DataGrouping.ViewModels.Project');Client.DataGrouping.ViewModels.TreeDataView.registerClass('Client.DataGrouping.ViewModels.TreeDataView',SparkleXrm.GridEditor.DataViewBase,Object);Client.DataGrouping.ViewModels.TreeDataViewModel.registerClass('Client.DataGrouping.ViewModels.TreeDataViewModel',SparkleXrm.ViewModelBase);Client.DataGrouping.ViewModels.TreeItem.registerClass('Client.DataGrouping.ViewModels.TreeItem');Client.DataGrouping.ViewModels.GroupedItems.registerClass('Client.DataGrouping.ViewModels.GroupedItems');Client.DataGrouping.Views.DataGroupingView.registerClass('Client.DataGrouping.Views.DataGroupingView');Client.DataGrouping.Views.GroupGridRowPlugin.registerClass('Client.DataGrouping.Views.GroupGridRowPlugin',null,Object);Client.DataGrouping.Views.TreeView.registerClass('Client.DataGrouping.Views.TreeView');Client.InlineSubGrids.ViewModels.ActivitySubGridViewModel.registerClass('Client.InlineSubGrids.ViewModels.ActivitySubGridViewModel',SparkleXrm.ViewModelBase);Client.InlineSubGrids.ViewModels.BooksCollection.registerClass('Client.InlineSubGrids.ViewModels.BooksCollection',SparkleXrm.GridEditor.DataViewBase,ss.IEnumerable);Client.InlineSubGrids.ViewModels.BookValidation.registerClass('Client.InlineSubGrids.ViewModels.BookValidation');Client.InlineSubGrids.ViewModels.ContactCardViewModel.registerClass('Client.InlineSubGrids.ViewModels.ContactCardViewModel',SparkleXrm.ViewModelBase);Client.InlineSubGrids.ViewModels.Book.registerClass('Client.InlineSubGrids.ViewModels.Book',Xrm.Sdk.Entity);Client.InlineSubGrids.ViewModels.SimpleEditableGridViewModel.registerClass('Client.InlineSubGrids.ViewModels.SimpleEditableGridViewModel',SparkleXrm.ViewModelBase);Client.Views.InlineSubGrids.ActivitySubGridView.registerClass('Client.Views.InlineSubGrids.ActivitySubGridView');Client.Views.InlineSubGrids.SimpleEditableGridView.registerClass('Client.Views.InlineSubGrids.SimpleEditableGridView');Client.InlineSubGrids.Views.ContactCardView.registerClass('Client.InlineSubGrids.Views.ContactCardView');Client.MultiEntitySearch.ViewModels.MultiSearchViewModel.registerClass('Client.MultiEntitySearch.ViewModels.MultiSearchViewModel',SparkleXrm.ViewModelBase);Client.MultiEntitySearch.ViewModels.QueryParser.registerClass('Client.MultiEntitySearch.ViewModels.QueryParser');Client.MultiEntitySearch.Views.MultiSearchView.registerClass('Client.MultiEntitySearch.Views.MultiSearchView');Client.QuoteLineItemEditor.Model.QuoteDetail.registerClass('Client.QuoteLineItemEditor.Model.QuoteDetail',Xrm.Sdk.Entity);Client.QuoteLineItemEditor.ViewModels.ObservableQuoteDetail.registerClass('Client.QuoteLineItemEditor.ViewModels.ObservableQuoteDetail');Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation.registerClass('Client.QuoteLineItemEditor.ViewModels.QuoteDetailValidation');Client.QuoteLineItemEditor.ViewModels.QuoteLineItemEditorViewModel.registerClass('Client.QuoteLineItemEditor.ViewModels.QuoteLineItemEditorViewModel',SparkleXrm.ViewModelBase);Client.QuoteLineItemEditor.Views.QuoteLineItemEditorView.registerClass('Client.QuoteLineItemEditor.Views.QuoteLineItemEditorView',SparkleXrm.ViewBase);Client.ScheduledJobsEditor.Model.BulkDeleteOperation.registerClass('Client.ScheduledJobsEditor.Model.BulkDeleteOperation',Xrm.Sdk.Entity);Client.ScheduledJobsEditor.Model.dev1_ScheduledJob.registerClass('Client.ScheduledJobsEditor.Model.dev1_ScheduledJob',Xrm.Sdk.Entity);Client.ScheduledJobsEditor.Model.asyncoperation.registerClass('Client.ScheduledJobsEditor.Model.asyncoperation',Xrm.Sdk.Entity);Client.ScheduledJobsEditor.ViewModels.ScheduledJob.registerClass('Client.ScheduledJobsEditor.ViewModels.ScheduledJob');Client.ScheduledJobsEditor.ViewModels.ScheduledJobsEditorViewModel.registerClass('Client.ScheduledJobsEditor.ViewModels.ScheduledJobsEditorViewModel',SparkleXrm.ViewModelBase);Client.ScheduledJobsEditor.ViewModels.PendingDelete.registerClass('Client.ScheduledJobsEditor.ViewModels.PendingDelete');Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames.registerClass('Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames');Client.ScheduledJobsEditor.ViewModels.DayNames.registerClass('Client.ScheduledJobsEditor.ViewModels.DayNames');Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper.registerClass('Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper');Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.registerClass('Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView',SparkleXrm.ViewBase);Client.ContactEditor.Model.Contact.registerClass('Client.ContactEditor.Model.Contact',Xrm.Sdk.Entity);Client.Views.ContactEditorView.registerClass('Client.Views.ContactEditorView',SparkleXrm.ViewBase);Client.TimeSheet.Model.Queries.registerClass('Client.TimeSheet.Model.Queries');TimeSheet.Client.ViewModel.ObservableActivityPointer.registerClass('TimeSheet.Client.ViewModel.ObservableActivityPointer');TimeSheet.Client.ViewModel.SessionVM.registerClass('TimeSheet.Client.ViewModel.SessionVM');TimeSheet.Client.ViewModel.StartStopSessionViewModel.registerClass('TimeSheet.Client.ViewModel.StartStopSessionViewModel',SparkleXrm.ViewModelBase);Client.TimeSheet.ViewModel.DayEntry.registerClass('Client.TimeSheet.ViewModel.DayEntry',Xrm.Sdk.Entity);Client.TimeSheet.ViewModel.DaysViewModel.registerClass('Client.TimeSheet.ViewModel.DaysViewModel',SparkleXrm.GridEditor.DataViewBase);Client.TimeSheet.ViewModel.SessionsViewModel.registerClass('Client.TimeSheet.ViewModel.SessionsViewModel',SparkleXrm.GridEditor.DataViewBase);Client.TimeSheet.ViewModel.TimeSheetViewModel.registerClass('Client.TimeSheet.ViewModel.TimeSheetViewModel',SparkleXrm.ViewModelBase);Client.TimeSheet.View.StartStopSession.registerClass('Client.TimeSheet.View.StartStopSession',SparkleXrm.ViewBase);Client.TimeSheet.View.TimeSheetView.registerClass('Client.TimeSheet.View.TimeSheetView',SparkleXrm.ViewBase);ActivityPointer.entityLogicalName='activitypointer';ActivityPointer.entityTypeCode=4200;dev1_session.entityLogicalName='dev1_session';dev1_session.entityTypeCode=10000;(function(){})();
Client.InlineSubGrids.Views.ContactCardView.$0=null;Client.ScheduledJobsEditor.Model.BulkDeleteOperation.entityLogicalName='bulkdeleteoperation';Client.ScheduledJobsEditor.Model.dev1_ScheduledJob.entityLogicalName='dev1_scheduledjob';Client.ScheduledJobsEditor.Model.asyncoperation.entityLogicalName='asyncoperation';Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames.YEARLY='YEARLY';Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames.WEEKLY='WEEKLY';Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames.DAILY='DAILY';Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames.HOURLY='HOURLY';Client.ScheduledJobsEditor.ViewModels.RecurranceFrequencyNames.MINUTELY='MINUTELY';Client.ScheduledJobsEditor.ViewModels.DayNames.monday='MO';Client.ScheduledJobsEditor.ViewModels.DayNames.tuesday='TU';Client.ScheduledJobsEditor.ViewModels.DayNames.wednesday='WE';Client.ScheduledJobsEditor.ViewModels.DayNames.thursday='TH';Client.ScheduledJobsEditor.ViewModels.DayNames.friday='FR';Client.ScheduledJobsEditor.ViewModels.DayNames.saturday='SA';Client.ScheduledJobsEditor.ViewModels.DayNames.sunday='SU';Client.ScheduledJobsEditor.ViewModels.RecurrancePatternMapper._frequencies=null;Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.jobsGrid=null;Client.ScheduledJobsEditor.Views.ScheduledJobsEditorView.bulkDeleteJobsGrid=null;Client.TimeSheet.Model.Queries.currentRunningActivities="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='false'>"+"<entity name='activitypointer'>"+"<attribute name='activitytypecode' />"+"<attribute name='subject' />"+"<attribute name='activityid' />"+"<attribute name='instancetypecode' />"+"<order attribute='modifiedon' descending='false' />"+"<filter type='and'>"+"<condition attribute='ownerid' operator='eq-userid' />"+'</filter>'+'</entity>'+'</fetch>';Client.TimeSheet.Model.Queries.currentOpenActivitesWithSessions="<fetch version='1.0' output-format='xml-platform' mapping='logical' aggregate='true'>"+"<entity name='activitypointer'>"+"<attribute name='subject' groupby='true' alias='a.subject'/>"+"<attribute name='activityid' groupby='true' alias='a.activityid'/>"+"<filter type='and'>"+"<condition attribute='ownerid' operator='eq-userid'  />"+"<condition attribute='statecode' operator='not-in'>"+'<value>1</value>'+'<value>2</value>'+'</condition>'+'</filter>'+"<link-entity name='dev1_session' from='dev1_activityid' to='activityid' alias='s'>"+"<attribute name='dev1_runningflag' aggregate='max' distinct='true' alias='isRunning'/>"+'</link-entity>'+'</entity>'+'</fetch>';Client.TimeSheet.Model.Queries.sessionsByWeekStartDate="\r\n                    <fetch>\r\n                        <entity name='dev1_session' >\r\n                            <attribute name='dev1_sessionid' />\r\n                            <attribute name='dev1_description' />\r\n                            <attribute name='dev1_activityid' />\r\n                            <attribute name='dev1_activitytypename' />\r\n                            <attribute name='dev1_starttime' />\r\n                            <attribute name='dev1_endtime' />\r\n                            <attribute name='dev1_duration' />\r\n                            <attribute name='dev1_taskid' />\r\n                            <attribute name='dev1_letterid' />\r\n                            <attribute name='dev1_emailid' />\r\n                            <attribute name='dev1_phonecallid' />\r\n                            <attribute name='statuscode' />\r\n                            <attribute name='dev1_row' />\r\n                            <order attribute='dev1_row' descending='false' />\r\n                            <filter type='and'>\r\n                                <condition attribute='dev1_starttime' operator='on-or-after' value='{0}' />\r\n                                <condition attribute='dev1_starttime' operator='on-or-before' value='{1}' />\r\n                            </filter>\r\n                            <link-entity name='activitypointer' from='activityid' to='dev1_activityid' alias='aa' >\r\n                                <attribute name='regardingobjectid' alias='activitypointer_regardingobjectid' />\r\n                                <attribute name='subject' alias='activitypointer_subject' />\r\n                                <link-entity name='contract' from='contractid' to='regardingobjectid' visible='false' link-type='outer' alias='contract' >\r\n                                    <attribute name='customerid' alias='contract_customerid'/>\r\n                                </link-entity>\r\n                                <link-entity name='opportunity' from='opportunityid' to='regardingobjectid' visible='false' link-type='outer' alias='opportunity' >\r\n                                    <attribute name='customerid' alias='opportunity_customerid'/>\r\n                                </link-entity>\r\n                                <link-entity name='incident' from='incidentid' to='regardingobjectid' visible='false' link-type='outer' alias='incident' >\r\n                                    <attribute name='customerid' alias='incident_customerid'/>\r\n                                </link-entity>\r\n                            </link-entity>\r\n                        </entity>\r\n                    </fetch>";Client.TimeSheet.View.TimeSheetView.$1_0=null;Client.TimeSheet.View.TimeSheetView.$1_1=null;Client.TimeSheet.View.TimeSheetView.$1_2=4;})(window.xrmjQuery);