// SparkleXrm.UnitTests.js
(function(){
Type.registerNamespace('SparkleXrm.UnitTests');SparkleXrm.UnitTests.MetadataQueryTests=function(){}
SparkleXrm.UnitTests.MetadataQueryTests.prototype={queryAllMetaData:function(){var $0=new Xrm.Sdk.Messages.RetrieveMetadataChangesRequest();$0.query={};$0.query.criteria={};$0.query.criteria.filterOperator='Or';$0.query.criteria.conditions=[];var $1={};$1.conditionOperator='Equals';$1.propertyName='LogicalName';$1.value='account';$0.query.criteria.conditions.add($1);$0.query.properties={};$0.query.properties.propertyNames=['Attributes'];var $2={};$2.properties={};$2.properties.propertyNames=['OptionSet'];$0.query.attributeQuery=$2;var $3={};$2.criteria=$3;$3.filterOperator='And';$3.conditions=[];var $4=Xrm.Sdk.OrganizationServiceProxy.execute($0);return true;},queryNameAttributeForAccount:function(){var $0=new Xrm.Sdk.Metadata.Query.MetadataQueryBuilder();$0.addEntities(['account'],['PrimaryNameAttribute']);var $1=Xrm.Sdk.OrganizationServiceProxy.execute($0.request);QUnit.equal($1.entityMetadata[0].primaryNameAttribute,'name');return true;},queryAttributeDisplayNamesForTwoEntities:function(){var $0=new Xrm.Sdk.Metadata.Query.MetadataQueryBuilder();$0.addEntities(['account','contact'],['Attributes','DisplayName','DisplayCollectionName']);$0.addAttributes(['name','firstname','statecode','statuscode'],['DisplayName']);var $1=Xrm.Sdk.OrganizationServiceProxy.execute($0.request);return true;},queryOneToManyRelationship:function(){var $0=new Xrm.Sdk.RetrieveRelationshipRequest();$0.name='contact_customer_accounts';$0.retrieveAsIfPublished=true;var $1=Xrm.Sdk.OrganizationServiceProxy.execute($0);var $2=$1.relationshipMetadata;QUnit.equal($2.isCustomRelationship,false);QUnit.equal($2.schemaName,'contact_customer_accounts');QUnit.equal($2.referencedAttribute,'accountid');return true;},queryManyToManyRelationship:function(){var $0=new Xrm.Sdk.RetrieveRelationshipRequest();$0.name='accountleads_association';$0.retrieveAsIfPublished=true;var $1=Xrm.Sdk.OrganizationServiceProxy.execute($0);var $2=$1.relationshipMetadata;QUnit.equal($2.isCustomRelationship,false);QUnit.equal($2.schemaName,'accountleads_association');QUnit.equal($2.intersectEntityName,'accountleads');return true;}}
SparkleXrm.UnitTests.OrganizationServiceProxyTests=function(){}
SparkleXrm.UnitTests.OrganizationServiceProxyTests.prototype={crudTests:function(){var $0=Date.get_now().toISOString()+Date.get_now().toTimeString();var $1=new Xrm.Sdk.Entity('contact');$1.setAttributeValue('lastname','Test Contact1 '+$0);$1.id=Xrm.Sdk.OrganizationServiceProxy.create($1).toString();var $2=new Xrm.Sdk.Entity('contact');$2.setAttributeValue('lastname','Test Contact2 '+$0);$2.id=Xrm.Sdk.OrganizationServiceProxy.create($2).toString();var $3=new Xrm.Sdk.Entity('activityparty');$3.setAttributeValue('partyid',$1.toEntityReference());var $4=[];Xrm.ArrayEx.add($4,$3);var $5=new Xrm.Sdk.Entity('email');$5.setAttributeValue('to',new Xrm.Sdk.EntityCollection($4));$5.setAttributeValue('subject','Unit Test email '+$0);$5.setAttributeValue('id',Xrm.Sdk.OrganizationServiceProxy.create($5));$5.id=$5.getAttributeValue('id').toString();var $6=Xrm.Sdk.OrganizationServiceProxy.retrieve('email',$5.id,['to','subject']);var $7=$6.getAttributeValue('to');var $8=new Xrm.Sdk.Entity('activityparty');$8.setAttributeValue('partyid',$2.toEntityReference());var $9=$7.get_entities().items();Xrm.ArrayEx.add($9,$8);Xrm.Sdk.OrganizationServiceProxy.update($6);Xrm.Sdk.OrganizationServiceProxy.delete_($5.logicalName,new Xrm.Sdk.Guid($5.id));Xrm.Sdk.OrganizationServiceProxy.delete_($1.logicalName,new Xrm.Sdk.Guid($1.id));Xrm.Sdk.OrganizationServiceProxy.delete_($2.logicalName,new Xrm.Sdk.Guid($2.id));return true;}}
SparkleXrm.UnitTests.MetadataQueryTests.registerClass('SparkleXrm.UnitTests.MetadataQueryTests');SparkleXrm.UnitTests.OrganizationServiceProxyTests.registerClass('SparkleXrm.UnitTests.OrganizationServiceProxyTests');})();// This script was generated using Script# v0.7.4.0
